define(["jquery","knockout"],function(e,t){return function(o){/*! KoGrid v2.1.5 | MIT License */
"use strict";o.kg||(o.kg={}),o.kg.numberOfGrids=0,o.kg.eventStorage={};var n="__kg_selected__",i=8,r=6,a="asc",l="desc",s="_kg_field_",c="_kg_depth_",d="_kg_hidden_",g="_kg_column_",u="_kg_agg_index_",p=/<.+>/;o.kg.moveSelectionHandler=function(e,t){if(o.kg.utils.isNullOrUndefined(e)||o.kg.utils.isNullOrUndefined(e.config.selectedItems))return!0;var n=t.which||t.keyCode,r=38===n?-1:40===n?1:null;if(!r)return!0;var a=e.renderedRows(),l=a.indexOf(e.selectionService.lastClickedRow)+r;return l<0||l>=a.length||(e.selectionService.ChangeSelection(a[l],t),l>a.length-i?e.$viewport.scrollTop(e.$viewport.scrollTop()+e.config.rowHeight*i):l<i&&e.$viewport.scrollTop(e.$viewport.scrollTop()-e.config.rowHeight*i),!1)},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,o=Number(arguments[1])||0;for(o=o<0?Math.ceil(o):Math.floor(o),o<0&&(o+=t);o<t;o++)if(o in this&&this[o]===e)return o;return-1}),Array.prototype.filter||(Array.prototype.filter=function(e){var t=Object(this),o=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=[],i=arguments[1],r=0;r<o;r++)if(r in t){var a=t[r];e.call(i,a,r,t)&&n.push(a)}return n}),o.kg.utils={visualLength:function(t){var o=document.getElementById("testDataLength");return o||(o=document.createElement("SPAN"),o.id="testDataLength",o.style.visibility="hidden",document.body.appendChild(o)),e(o).css("font",e(t).css("font")),o.innerHTML=e(t).text(),o.offsetWidth},forIn:function(e,t){for(var o in e)e.hasOwnProperty(o)&&t(e[o],o)},evalProperty:function(e,o){var n=t.utils.unwrapObservable(e),i=o.split("."),r=0,a=t.utils.unwrapObservable(n[i[r]]),l=i.length;for(r++;a&&r<l;)a=t.utils.unwrapObservable(a[i[r]]),r++;return a},endsWith:function(e,t){return!(!e||!t||"string"!=typeof e)&&e.indexOf(t,e.length-t.length)!==-1},isNullOrUndefined:function(e){return void 0===e||null===e},getElementsByClassName:function(e){for(var t=[],o=new RegExp("\\b"+e+"\\b"),n=document.getElementsByTagName("*"),i=0;i<n.length;i++){var r=n[i].className;o.test(r)&&t.push(n[i])}return t},getTemplatePromise:function(t){return e.ajax(t)},newId:function(){var e=(new Date).getTime();return function(){return e+=1}}(),ieVersion:function(){for(var e=3,t=document.createElement("div"),o=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",o[0];);return e>4?e:void 0}()},e.extend(o.kg.utils,{isIe6:function(){return 6===o.kg.utils.ieVersion}(),isIe7:function(){return 7===o.kg.utils.ieVersion}(),isIe:function(){return void 0!==o.kg.utils.ieVersion}()}),o.kg.aggregateTemplate=function(){return'<div data-bind="click: toggleExpand, style: {\'left\': offsetLeft()}" class="kgAggregate"><span class="kgAggregateText"><span class="kgAggregateLabel" data-bind="html: $data.label"></span> <span class="kgAggregateTotal"><span data-bind="html: totalChildren"></span> <span data-bind="text: totalChildren() > 1 ? \'Items\' : \'Item\'"></span></span></span><div data-bind="attr: {\'class\' : aggClass }"></div></div>'},o.kg.defaultCellTemplate=function(){return"<div data-bind=\"attr: { 'class': 'kgCellText colt' + $index()}, html: $data.getProperty($parent)\"></div>"},o.kg.defaultGridTemplate=function(){return'<div data-bind="css: {\'ui-widget\': jqueryUITheme, \'kgNoSelect\' : disableTextSelection}"><div class="kgTopPanel" data-bind="css: {\'ui-widget-header\':jqueryUITheme, \'ui-corner-top\': jqueryUITheme}, style: $data.topPanelStyle"><div class="kgGroupPanel" data-bind="visible: $data.showGroupPanel, style: headerStyle"><div class="kgGroupPanelDescription" data-bind="visible: configGroups().length == 0">Drag a column header here and drop it to group by that column</div><ul data-bind="visible: configGroups().length > 0, foreach: configGroups" class="kgGroupList"><li class="kgGroupItem"><span class="kgGroupElement"><div class="kgGroupName"><span data-bind="text: displayName"></span> <span data-bind="click: function(data) { $root.removeGroup($index()) }" class="kgRemoveGroup">x</span></div><span data-bind="visible: $index() < ($root.configGroups().length - 1)" class="kgGroupArrow"></span></span></li></ul></div><div class="kgHeaderContainer" data-bind="style: headerStyle"><div class="kgHeaderScroller" data-bind="style: headerScrollerStyle, kgHeaderRow: $data"></div></div><div class="kgHeaderButton" data-bind="visible: ($data.showColumnMenu || $data.showFilter), click: toggleShowMenu"><div class="kgHeaderButtonArrow"></div></div><div data-bind="visible: showMenu" class="kgColMenu"><div data-bind="visible: showFilter"><input placeholder="Search Field:Value" type="text" data-bind="value: filterText, valueUpdate: \'afterkeydown\'"></div><div data-bind="visible: showColumnMenu"><span class="kgMenuText">Choose Columns:</span><ul class="kgColList" data-bind="foreach: nonAggColumns"><li class="kgColListItem"><label style="position: relative"><input type="checkbox" class="kgColListCheckbox" data-bind="checked: visible"> <span data-bind="text: displayName, click: toggleVisible"></span> <a title="Group By" data-bind="attr: {\'class\': groupedByClass }, visible: (field != \'\\u2714\'), click: $parent.groupBy"></a> <span class="kgGroupingNumber" data-bind="visible: groupIndex() > 0, text: groupIndex"></span></label></li></ul></div></div></div><div class="kgViewport" data-bind="css: {\'ui-widget-content\': jqueryUITheme}, style: viewportStyle"><div class="kgCanvas" data-bind="style: canvasStyle, delegatedHandler: delegatedHandler"><div data-bind="foreach: renderedRows" style="position: absolute"><div data-bind="style: { \'top\': offsetTop, \'height\': ($data.groupHeaderHeight || $parent.rowHeight) + \'px\' }, click: toggleSelected, css: {\'selected\': selected, \'even\': isEven , \'odd\': isOdd, \'ui-state-default\': $parent.jqueryUITheme && isOdd, \'ui-state-active\':$parent.jqueryUITheme && isEven}, kgRow: $data" class="kgRow"></div></div></div></div><div class="kgFooterPanel" data-bind="css: {\'ui-widget-content\': jqueryUITheme, \'ui-corner-bottom\': jqueryUITheme}, style: footerStyle"><div class="kgTotalSelectContainer" data-bind="visible: footerVisible"><div class="kgFooterTotalItems" data-bind="css: {\'kgNoMultiSelect\': !multiSelect}"><span class="kgLabel">Total Items: <span data-bind="text: maxRowsDisplay"></span></span><span data-bind="visible: filterText().length > 0" class="kgLabel">(Showing: <span data-bind="text: totalFilteredItemsLength"></span>)</span></div><div class="kgFooterSelectedItems" data-bind="visible: multiSelect"><span class="kgLabel">Selected Items: <span data-bind="text: selectedItemCount"></span></span></div></div><div class="kgPagerContainer" style="float: right; margin-top: 10px" data-bind="visible: (footerVisible && enablePaging), css: {\'kgNoMultiSelect\': !multiSelect}"><div style="float:left; margin-right: 10px" class="kgRowCountPicker"><span style="float: left; margin-top: 3px" class="kgLabel">Page Size:</span><select style="float: left;height: 27px; width: 100px" data-bind="value: pagingOptions.pageSize, options: pagingOptions.pageSizes"></select></div><div style="float:left; margin-right: 10px; line-height:25px" class="kgPagerControl" style="float: left; min-width: 135px"><button class="kgPagerButton" data-bind="click: pageToFirst, disable: cantPageBackward()" title="First Page"><div class="kgPagerFirstTriangle"><div class="kgPagerFirstBar"></div></div></button> <button class="kgPagerButton" data-bind="click: pageBackward, disable: cantPageBackward()" title="Previous Page"><div class="kgPagerFirstTriangle kgPagerPrevTriangle"></div></button> <input class="kgPagerCurrent" type="number" style="width:50px; height: 24px; margin-top: 1px; padding: 0px 4px" data-bind="value: pagingOptions.currentPage, valueUpdate: \'afterkeydown\'"> <button class="kgPagerButton" data-bind="click: pageForward, disable: cantPageForward()" title="Next Page"><div class="kgPagerLastTriangle kgPagerNextTriangle"></div></button> <button class="kgPagerButton" data-bind="click: pageToLast, disable: cantPageForward()" title="Last Page"><div class="kgPagerLastTriangle"><div class="kgPagerLastBar"></div></div></button></div></div></div></div>'},o.kg.defaultHeaderCellTemplate=function(){return"<div data-bind=\"style: { cursor : sortable() ? 'pointer' : 'default' }, click: sort, css: {'kgSorted': !noSortVisible }, attr: {'class': 'kgHeaderSortColumn ' + headerClass()}\"><div data-bind=\"attr: { 'class': 'colt' + $index() + ' kgHeaderText' }, html: displayName\"></div><div class=\"kgSortButtonDown\" data-bind=\"visible: showSortButtonDown\"></div><div class=\"kgSortButtonUp\" data-bind=\"visible: showSortButtonUp\"></div><div data-bind=\"visible: resizable, click: gripClick, mouseEvents: { mouseDown: gripOnMouseDown }\" class=\"kgHeaderGrip\"></div></div>"},o.kg.defaultHeaderRowTemplate=function(){return"<div data-bind=\"foreach: visibleColumns\"><div data-bind=\"kgHeaderCell: $data, attr: { 'class': 'kgHeaderCell col' + $index() }\"></div></div>"},o.kg.defaultRowTemplate=function(){return"<div data-bind=\"style: { cursor : canSelectRows ? 'pointer' : 'default' }, foreach: $grid.visibleColumns, css: { 'ui-widget-content': $grid.jqueryUITheme }\"><div data-bind=\"attr: { 'class': cellClass() + ' kgCell row' + $parent.rowIndex() + ' col' + $index() }, kgCell: $data, click: onClick($parent), delegatedClick: delegatedClick($parent), delegatedDblclick: delegatedDblclick($parent)\"></div></div>"},t.bindingHandlers.kgCell=function(){return{init:function(o,n,i,r,a){a.$userViewModel=a.$parent.$userViewModel;var l=function(n){var i=e(n);t.applyBindings(a,i[0]),e(o).html(i)};return r.cellTemplate.then?r.cellTemplate.then(function(e){l(e)}):l(r.cellTemplate),{controlsDescendantBindings:!0}}}}(),t.bindingHandlers.kgHeaderCell=function(){return{init:function(o,n,i,r,a){var l=a.extend({$grid:a.$parent,$userViewModel:a.$parent.$userViewModel}),s=function(n){var i=e(n);t.applyBindings(l,i[0]),e(o).html(i)};return r.headerCellTemplate.then?r.headerCellTemplate.then(function(e){s(e)}):s(r.headerCellTemplate),{controlsDescendantBindings:!0}}}}(),t.bindingHandlers.kgHeaderRow=function(){return{init:function(o,n,i,r,a){a.$userViewModel=a.$data.$userViewModel;var l=function(n){var i=e(n);t.applyBindings(a,i[0]),e(o).html(i)};return r.headerRowTemplate.then?r.headerRowTemplate.then(function(e){l(e)}):l(r.headerRowTemplate),{controlsDescendantBindings:!0}}}}(),t.bindingHandlers.mouseEvents=function(){return{init:function(t,o,n,i,r){var a=o();a.mouseDown&&e(t).mousedown(a.mouseDown)}}}(),t.bindingHandlers.kgRow=function(){return{init:function(n,i,r,a,l){var s,c=i(),d=c.$grid=l.$parent;s=c.isAggRow?o.kg.aggregateTemplate():d.rowTemplate;var g=function(o){var i=e(o);c.$userViewModel=l.$parent.$userViewModel,t.applyBindings(c,i[0]),e(n).html(i)};return s.then?s.then(function(e){g(e)}):g(s),{controlsDescendantBindings:!0}}}}(),t.bindingHandlers.koGrid=function(){return{init:function(n,i,r,a,l){t.bindingHandlers.delegatedHandler||(t.bindingHandlers.delegatedHandler={init:function(){}},t.bindingHandlers.delegatedClick={init:function(){}},t.bindingHandlers.delegatedDblclick={init:function(){}});var s=i(),c=e(n);s.gridDim=new o.kg.Dimension({outerHeight:t.observable(c.height()),outerWidth:t.observable(c.width())});var d=new o.kg.Grid(s),g=e(o.kg.defaultGridTemplate());return s.data.subscribe(function(){d.$$selectionPhase||(d.searchProvider.evalFilter(),d.refreshDomSizes())}),t.isObservable(s.columnDefs)&&s.columnDefs.subscribe(function(e){d.columns([]),d.config.columnDefs=e,d.buildColumns(),d.configureColumnWidths()}),c.addClass("koGrid").addClass(d.gridId.toString()),c.append(g),d.$userViewModel=l.$data,t.applyBindings(d,g[0]),o.kg.domUtilityService.AssignGridContainers(c,d),d.configureColumnWidths(),d.refreshDomSizes(),d.eventProvider=new o.kg.EventProvider(d),e.each(d.config.plugins,function(e,t){"function"==typeof t.onGridInit&&t.onGridInit(d)}),o.kg.domUtilityService.BuildStyles(d),{controlsDescendantBindings:!0}}}}(),o.kg.Aggregate=function(o,n){var i=this;i.index=0,i.offsetTop=t.observable(0),i.entity=o,i.label=t.observable(o.gLabel),i.field=o.gField,i.depth=o.gDepth,i.parent=o.parent,i.children=t.observableArray(o.children),i.aggChildren=o.aggChildren,i.aggIndex=o.aggIndex,i.collapsed=t.observable(n.collapseGroups),i.isAggRow=!0,i.offsetLeft=t.observable((25*o.gDepth).toString()+"px"),i.aggLabelFilter=o.aggLabelFilter,i.toggleExpand=function(){var e=i.collapsed();i.collapsed(!e),i.notifyChildren()},i.setExpand=function(e){i.collapsed(e),i.notifyChildren()},i.notifyChildren=function(){e.each(i.aggChildren,function(e,t){if(t.entity[d]=i.collapsed(),i.collapsed()){var o=i.collapsed();t.setExpand(o)}}),e.each(i.children(),function(e,t){t[d]=i.collapsed()}),n.rowCache=[],n.renderedChange()},i.aggClass=t.computed(function(){return i.collapsed()?"kgAggArrowCollapsed":"kgAggArrowExpanded"}),i.totalChildren=t.computed(function(){if(i.aggChildren.length>0){var t=0,o=function(n){n.aggChildren.length>0?e.each(n.aggChildren,function(e,t){o(t)}):t+=n.children().length};return o(i),t}return i.children().length}).extend({rateLimit:500}),i.selected=t.observable(!1),i.isEven=t.observable(!1),i.isOdd=t.observable(!1),i.toggleSelected=function(){return!0}},o.kg.Column=function(n,i){var r=this,s=n.colDef,c=500,d=0,g=null;r.eventTarget=void 0,r.width=s.width,r.groupIndex=t.observable(0),r.isGroupedBy=t.observable(!1),r.groupedByClass=t.computed(function(){return r.isGroupedBy()?"kgGroupedByIcon":"kgGroupIcon"}),r.sortable=t.observable(!1),r.resizable=t.observable(!1),r.minWidth=s.minWidth?s.minWidth:50,r.maxWidth=s.maxWidth?s.maxWidth:9e3,r.headerRowHeight=n.headerRowHeight,r.displayName=t.observable(s.displayName||s.field),r.index=n.index,r.isAggCol=n.isAggCol,r.cellClass=t.observable(s.cellClass||""),r.cellFilter=s.cellFilter||s.cellFormatter,r.field=s.field,r.aggLabelFilter=s.cellFilter||s.cellFormatter||s.aggLabelFilter||s.aggLabelFormatter,r._visible=t.observable(o.kg.utils.isNullOrUndefined(s.visible)||s.visible),r.visible=t.computed({read:function(){return r._visible()},write:function(e){r.toggleVisible(e)}}),n.enableSort&&r.sortable(o.kg.utils.isNullOrUndefined(s.sortable)||s.sortable),n.enableResize&&r.resizable(o.kg.utils.isNullOrUndefined(s.resizable)||s.resizable),r.sortDirection=t.observable(void 0),r.sortingAlgorithm=s.sortFn,r.headerClass=t.observable(s.headerClass),r.headerCellTemplate=s.headerCellTemplate||o.kg.defaultHeaderCellTemplate(),r.cellTemplate=s.cellTemplate||o.kg.defaultCellTemplate(),s.cellTemplate&&!p.test(s.cellTemplate)&&(r.cellTemplate=o.kg.utils.getTemplatePromise(s.cellTemplate)),s.headerCellTemplate&&!p.test(s.headerCellTemplate)&&(r.headerCellTemplate=o.kg.utils.getTemplatePromise(s.headerCellTemplate)),r.onClick=function(){return null},s.onClick&&(r.cellClass(r.cellClass()+" kgClickable"),r.onClick=function(e){return function(t,o){s.onClick(e,t,o)}}),r.delegatedClick=function(){return null},s.delegatedClick&&(r.cellClass(r.cellClass()+" kgClickable"),r.delegatedClick=function(e){return function(t,o){s.delegatedClick(e,t,o)}}),r.delegatedDblclick=function(){return null},s.delegatedDblclick&&(r.cellClass(r.cellClass()+" kgClickable"),r.delegatedDblclick=function(e){return function(t,o){s.delegatedDblclick(e,t,o)}}),r.getProperty=function(e){var t;return t=r.cellFilter?r.cellFilter(e.getProperty(r.field)):e.getProperty(r.field)},r.toggleVisible=function(e){var t;t=o.kg.utils.isNullOrUndefined(e)||"object"==typeof e?!r._visible():e,r._visible(t),o.kg.domUtilityService.BuildStyles(i)},r.showSortButtonUp=t.computed(function(){return r.sortable?r.sortDirection()===l:r.sortable}),r.showSortButtonDown=t.computed(function(){return r.sortable?r.sortDirection()===a:r.sortable}),r.noSortVisible=t.computed(function(){return!r.sortDirection()}),r.sort=function(){if(!r.sortable())return!0;var e=r.sortDirection()===a?l:a;return r.sortDirection(e),n.sortCallback(r,e),!1},r.gripClick=function(e,t){t.stopPropagation(),d++,1===d?g=setTimeout(function(){d=0},c):(clearTimeout(g),n.resizeOnDataCallback(r),d=0)},r.gripOnMouseDown=function(t){return t.stopPropagation(),t.ctrlKey?(r.toggleVisible(),o.kg.domUtilityService.BuildStyles(i),i.config.columnsChanged(i.columns.peek()),!0):(r.eventTarget=t.target.parentElement,r.eventTarget.style.cursor="col-resize",r.startMousePosition=t.clientX,r.origWidth=r.width,e(document).mousemove(r.onMouseMove),e(document).mouseup(r.gripOnMouseUp),!1)},r.onMouseMove=function(e){e.stopPropagation();var t=e.clientX-r.startMousePosition,n=t+r.origWidth;return r.width=n<r.minWidth?r.minWidth:n>r.maxWidth?r.maxWidth:n,o.kg.domUtilityService.BuildStyles(i),!1},r.gripOnMouseUp=function(t){return t.stopPropagation(),e(document).off("mousemove"),e(document).off("mouseup"),r.eventTarget.style.cursor=r.sortable()?"pointer":"default",r.eventTarget=void 0,i.config.columnsChanged(i.columns.peek()),!1}},o.kg.Dimension=function(t){this.outerHeight=null,this.outerWidth=null,e.extend(this,t)};var f=function(){var t=e("<div></div>");t.appendTo("body"),t.height(100).width(100).css("position","absolute").css("overflow","scroll"),t.append('<div style="height: 400px; width: 400px;"></div>'),o.kg.domUtilityService.ScrollH=t.height()-t[0].clientHeight,o.kg.domUtilityService.ScrollW=t.width()-t[0].clientWidth,t.empty(),t.attr("style",""),t.append('<span style="font-family: Verdana, Helvetica, Sans-Serif; font-size: 14px;"><strong>M</strong></span>'),o.kg.domUtilityService.LetterW=t.children().first().width(),t.remove()};o.kg.domUtilityService={AssignGridContainers:function(t,n){n.$root=e(t),n.$topPanel=n.$root.find(".kgTopPanel"),n.$groupPanel=n.$root.find(".kgGroupPanel"),n.$headerContainer=n.$topPanel.find(".kgHeaderContainer"),n.$headerScroller=n.$topPanel.find(".kgHeaderScroller"),n.$headers=n.$headerScroller.children(),n.$viewport=n.$root.find(".kgViewport"),n.$canvas=n.$viewport.find(".kgCanvas"),n.$footerPanel=n.$root.find(".ngFooterPanel"),o.kg.domUtilityService.UpdateGridLayout(n)},UpdateGridLayout:function(e){var t=e.$viewport.scrollTop(),o=e.$viewport.scrollLeft();e.elementDims.rootMaxW=e.$root.width(),e.elementDims.rootMaxH=e.$root.height(),e.refreshDomSizes(),e.adjustScrollTop(t,!0),e.adjustScrollLeft(o)},BuildStyles:function(t){var n,i=t.config.rowHeight,r=t.$styleSheet,a=t.gridId,l=t.visibleColumns(),s=0;r||(r=e("#"+a),r[0]||(r=e("<style id='"+a+"' type='text/css' rel='stylesheet' />"),r.appendTo("body"))),r.empty();var c=t.totalRowWidth();n="."+a+" .kgCanvas { width: "+c+"px; }."+a+" .kgRow { width: "+c+"px; }."+a+" .kgCell { height: "+i+"px; }."+a+" .kgCanvas { width: "+c+"px; }."+a+" .kgHeaderCell { top: 0; bottom: 0; }."+a+" .kgHeaderScroller { width: "+(c+o.kg.domUtilityService.scrollH+2)+"px}",e.each(l,function(e,t){n+="."+a+" .col"+e+" { width: "+t.width+"px; left: "+s+"px; right: "+(c-s-t.width)+"px; height: "+i+"px }."+a+" .colt"+e+" { width: "+t.width+"px; }",s+=t.width}),o.kg.utils.isIe?r[0].styleSheet.cssText=n:r.append(document.createTextNode(n)),t.$styleSheet=r},ScrollH:17,ScrollW:17,LetterW:10},f(),o.kg.EventProvider=function(n){var i=this;i.colToMove=void 0,i.groupToMove=void 0,i.assignEvents=function(){n.config.jqueryUIDraggable?(n.$groupPanel.droppable({addClasses:!1,drop:function(e){i.onGroupDrop(e)}}),e(document).ready(i.setDraggables)):(n.$groupPanel.on("mousedown",i.onGroupMouseDown).on("dragover",i.dragOver).on("drop",i.onGroupDrop),n.$headerScroller.on("mousedown",i.onHeaderMouseDown).on("dragover",i.dragOver).on("drop",i.onHeaderDrop),n.config.enableRowReordering&&n.$viewport.on("mousedown",i.onRowMouseDown).on("dragover",i.dragOver).on("drop",i.onRowDrop),i.setDraggables()),n.columns.subscribe(i.setDraggables)},i.dragOver=function(e){e.preventDefault()},i.setDraggables=function(){n.config.jqueryUIDraggable?n.$root.find(".kgHeaderSortColumn").draggable({helper:"clone",appendTo:"body",stack:"div",addClasses:!1,start:function(e){i.onHeaderMouseDown(e)}}).droppable({drop:function(e){i.onHeaderDrop(e)}}):(n.$root.find(".kgHeaderSortColumn").attr("draggable","true"),navigator.userAgent.indexOf("MSIE")!=-1&&n.$root.find(".kgHeaderSortColumn").bind("selectstart",function(){return this.dragDrop(),!1}))},i.onGroupMouseDown=function(o){var r=e(o.target);if("kgRemoveGroup"!=r[0].className){var a=t.dataFor(r[0]);a&&(n.config.jqueryUIDraggable||r.attr("draggable","true"),i.groupToMove={header:r,groupName:a,index:a.groupIndex()-1})}else i.groupToMove=void 0},i.onGroupDrop=function(o){var r,a;i.groupToMove?(r=e(o.target).closest(".kgGroupElement"),"kgGroupPanel"==r.context.className?(n.configGroups.splice(i.groupToMove.index,1),n.configGroups.push(i.groupToMove.groupName)):(a=t.dataFor(r[0]),a&&i.groupToMove.index!=a.groupIndex()&&(n.configGroups.splice(i.groupToMove.index,1),n.configGroups.splice(a.groupIndex(),0,i.groupToMove.groupName))),i.groupToMove=void 0,n.fixGroupIndexes()):(n.configGroups.indexOf(i.colToMove.col)==-1&&(r=e(o.target).closest(".kgGroupElement"),"kgGroupPanel"==r.context.className||"kgGroupPanelDescription"==r.context.className?n.groupBy(i.colToMove.col):(a=t.dataFor(r[0]),a&&n.removeGroup(a.groupIndex()))),i.colToMove=void 0)},i.onHeaderMouseDown=function(o){var n=e(o.target).closest(".kgHeaderSortColumn");if(!n[0])return!0;var r=t.dataFor(n[0]);return r&&(i.colToMove={header:n,col:r}),!0},i.onHeaderDrop=function(r){if(!i.colToMove)return!0;var a=e(r.target).closest(".kgHeaderSortColumn");if(!a[0])return!0;var l=t.dataFor(a[0]);if(l){if(i.colToMove.col==l)return!0;var s=n.columns.peek();s.splice(i.colToMove.col.index,1),s.splice(l.index,0,i.colToMove.col),n.fixColumnIndexes(),n.columns(s),o.kg.domUtilityService.BuildStyles(n),i.colToMove=void 0}return!0},i.onRowMouseDown=function(n){var i=e(n.target).closest(".kgRow");if(i[0]){var r=t.dataFor(i[0]);r&&(i.attr("draggable","true"),o.kg.eventStorage.rowToMove={targetRow:i,scope:r})}},i.onRowDrop=function(i){var r=e(i.target).closest(".kgRow"),a=t.dataFor(r[0]);if(a){var l=o.kg.eventStorage.rowToMove;if(l.scope==a)return;var s=n.sortedData(),c=s.indexOf(l.scope.entity),d=s.indexOf(a.entity);n.sortedData.splice(c,1),n.sortedData.splice(d,0,l.scope.entity),n.searchProvider.evalFilter(),o.kg.eventStorage.rowToMove=void 0}},i.assignGridEventHandlers=function(){n.$viewport.scroll(function(e){var t=e.target.scrollLeft,o=e.target.scrollTop;n.adjustScrollLeft(t),n.adjustScrollTop(o)}),n.$viewport.off("keydown"),n.config.arrowsSelectRows&&n.$viewport.on("keydown",function(e){return o.kg.moveSelectionHandler(n,e)}),n.config.tabIndex===-1?(n.$viewport.attr("tabIndex",o.kg.numberOfGrids),o.kg.numberOfGrids++):n.$viewport.attr("tabIndex",n.config.tabIndex),e(o).resize(function(){o.kg.domUtilityService.UpdateGridLayout(n),n.config.maintainColumnRatios&&n.configureColumnWidths()})},i.assignGridEventHandlers(),i.assignEvents()},o.kg.Grid=function(a){var l={rowHeight:43,columnWidth:100,headerRowHeight:30,groupHeaderHeight:43,groupIndent:!0,collapseGroups:!0,footerRowHeight:55,footerVisible:!0,displayFooter:void 0,canSelectRows:!0,selectAllState:t.observable(!1),data:t.observableArray([]),columnDefs:void 0,selectedItems:t.observableArray([]),displaySelectionCheckbox:!0,selectWithCheckboxOnly:!1,useExternalSorting:!1,sortInfo:t.observable(void 0),multiSelect:!0,tabIndex:-1,enableColumnResize:!0,enableSorting:!0,maintainColumnRatios:void 0,beforeSelectionChange:function(){return!0},afterSelectionChange:function(){return!0},columnsChanged:function(){},rowTemplate:void 0,headerRowTemplate:void 0,jqueryUITheme:!1,jqueryUIDraggable:!1,plugins:[],keepLastSelected:!0,groups:[],showGroupPanel:!1,enableRowReordering:!1,showColumnMenu:!0,showFilter:!0,disableTextSelection:!0,arrowsSelectRows:!0,filterOptions:{filterText:t.observable(""),useExternalFilter:!1},enablePaging:!1,pagingOptions:{pageSizes:t.observableArray([250,500,1e3]),pageSize:t.observable(250),totalServerItems:t.observable(0),currentPage:t.observable(1)}},s=this;s.maxCanvasHt=t.observable(0),s.config=e.extend(l,a),s.config.columnDefs=t.utils.unwrapObservable(a.columnDefs),s.gridId="ng"+o.kg.utils.newId(),s.$root=null,s.$groupPanel=null,s.$topPanel=null,s.$headerContainer=null,s.$headerScroller=null,s.$headers=null,s.$viewport=null,s.$canvas=null,s.rootDim=s.config.gridDim,s.sortInfo=t.isObservable(s.config.sortInfo)?s.config.sortInfo:t.observable(s.config.sortInfo),s.sortedData=s.config.data,s.lateBindColumns=!1,s.filteredData=t.observableArray([]),s.lastSortedColumn=void 0,s.showFilter=s.config.showFilter,s.filterText=s.config.filterOptions.filterText,s.disableTextSelection=t.observable(s.config.disableTextSelection),s.delegatedHandler=s.config.delegatedHandler||[],s.calcMaxCanvasHeight=function(){return s.configGroups().length>0?s.rowFactory.calculateHeightOfAllRows():s.filteredData().length*s.config.rowHeight},s.elementDims={scrollW:0,scrollH:0,rowIndexCellW:25,rowSelectedCellW:25,rootMaxW:0,rootMaxH:0},s.setRenderedRows=function(e){s.renderedRows(e),s.refreshDomSizes()},s.minRowsToRender=function(){var e=s.viewportDimHeight()||1,t=s.config.groupHeaderHeight?Math.min(s.config.rowHeight,s.config.groupHeaderHeight):s.config.rowHeight;return Math.floor(e/t)},s.refreshDomSizes=function(){s.rootDim.outerWidth(s.elementDims.rootMaxW),s.rootDim.outerHeight(s.elementDims.rootMaxH),s.maxCanvasHt(s.calcMaxCanvasHeight())},s.buildColumnDefsFromData=function(){var e=s.sortedData();if(s.config.columnDefs||(s.config.columnDefs=[]),!e||!e[0])return void(s.lateBoundColumns=!0);var t;t=e[0],o.kg.utils.forIn(t,function(e,t){t!=n&&s.config.columnDefs.push({field:t})})},s.buildColumns=function(){var t=s.config.columnDefs,n=[];t||(s.buildColumnDefsFromData(),t=s.config.columnDefs),s.config.displaySelectionCheckbox&&s.config.canSelectRows&&t.splice(0,0,{field:"✔",width:s.elementDims.rowSelectedCellW,sortable:!1,resizable:!1,headerCellTemplate:'<input class="kgSelectionHeader" type="checkbox" data-bind="visible: $grid.multiSelect, checked: $grid.allSelected"/>',cellTemplate:'<div class="kgSelectionCell"><input class="kgSelectionCheckbox" type="checkbox" data-bind="checked: $parent.selected" /></div>'}),t.length>0&&(e.each(t,function(e,t){var i=new o.kg.Column({colDef:t,index:e,headerRowHeight:s.config.headerRowHeight,sortCallback:s.sortData,resizeOnDataCallback:s.resizeOnData,enableResize:s.config.enableColumnResize,enableSort:s.config.enableSorting},s);n.push(i);var r=s.config.groups.indexOf(t.field);r!=-1&&s.configGroups.splice(r,0,i)}),s.columns(n))},s.configureColumnWidths=function(){var t=s.config.columnDefs,n=t.length,i=[],r=[],a=0,l=0,c=s.columns();if(e.each(t,function(t,n){var d,g=!1;if(o.kg.utils.isNullOrUndefined(n.width)?n.width="*":(g=!!isNaN(n.width)&&o.kg.utils.endsWith(n.width,"%"),d=g?n.width:parseInt(n.width,10)),isNaN(d))if(d=n.width,"auto"==d){c[t].width=c[t].minWidth;var u=c[t];e(document).ready(function(){s.resizeOnData(u,!0)})}else if(d.indexOf("*")!=-1)a+=d.length,n.index=t,i.push(n);else{if(!g)throw'unable to parse column width, use percentage ("10%","20%", etc...) or "*" to use remaining width of grid';n.index=t,r.push(n)}else l+=c[t].width=parseInt(n.width,10)}),i.length>0){s.config.maintainColumnRatios===!1?e.noop():s.config.maintainColumnRatios=!0;var d=s.rootDim.outerWidth()-l,g=Math.floor(d/a);e.each(i,function(e,t){var i=t.width.length;if(c[t.index].width=g*i,t.index+1==n){var r=2;s.maxCanvasHt()>s.viewportDimHeight()&&(r+=o.kg.domUtilityService.ScrollW),c[t.index].width-=r}l+=c[t.index].width})}r.length>0&&e.each(r,function(e,t){var o=t.width;c[t.index].width=Math.floor(s.rootDim.outerWidth()*(parseInt(o.slice(0,-1),10)/100))}),s.columns(c),o.kg.domUtilityService.BuildStyles(s)},s.init=function(){s.selectionService=new o.kg.SelectionService(s),s.rowFactory=new o.kg.RowFactory(s),s.selectionService.Initialize(s.rowFactory),s.buildColumns(),s.searchProvider=new o.kg.SearchProvider(s),s.styleProvider=new o.kg.StyleProvider(s),o.kg.sortService.columns=s.columns,s.configGroups.subscribe(function(t){if(t){var o=[];e.each(t,function(e,t){t&&o.push(t.field||t)}),s.config.groups=o,s.rowFactory.filteredDataChanged()}}),s.filteredData.subscribe(function(){s.$$selectionPhase||(s.maxCanvasHt(s.calcMaxCanvasHeight()),s.isSorting||s.configureColumnWidths())}),s.maxCanvasHt(s.calcMaxCanvasHeight()),s.searchProvider.evalFilter(),s.refreshDomSizes()},s.prevScrollTop=0,s.prevScrollIndex=0,s.adjustScrollTop=function(e,t){if(s.prevScrollTop!==e||t){var n=Math.floor(e/s.config.rowHeight);s.prevScrollTop<e&&n<s.prevScrollIndex+r||s.prevScrollTop>e&&n>s.prevScrollIndex-r||(s.prevScrollTop=e,s.rowFactory.UpdateViewableRange(new o.kg.Range(Math.max(0,n-i),n+s.minRowsToRender()+i)),s.prevScrollIndex=n)}},s.adjustScrollLeft=function(e){s.$headerContainer&&s.$headerContainer.scrollLeft(e)},s.resizeOnData=function(t){var n=t.minWidth,i=o.kg.utils.getElementsByClassName("col"+t.index);e.each(i,function(t,i){var r;if(0===t){var a=e(i).find(".kgHeaderText");r=o.kg.utils.visualLength(a)+10}else{var l=e(i).find(".kgCellText");r=o.kg.utils.visualLength(l)+10}r>n&&(n=r)}),t.width=n=Math.min(t.maxWidth,n+7),o.kg.domUtilityService.BuildStyles(s)},s.sortData=function(e,t){s.isSorting=!0,s.sortInfo({column:e,direction:t}),s.clearSortingData(e),s.config.useExternalSorting?s.config.sortInfo(s.sortInfo.peek()):o.kg.sortService.Sort(s.sortInfo.peek(),s.sortedData),s.lastSortedColumn=e,s.isSorting=!1},s.clearSortingData=function(t){t?s.lastSortedColumn&&t!=s.lastSortedColumn&&s.lastSortedColumn.sortDirection(""):e.each(s.columns(),function(e,t){t.sortDirection("")})},s.fixColumnIndexes=function(){s.$$indexPhase=!0;var t=s.columns.peek();e.each(t,function(e,t){t.index=e}),s.$$indexPhase=!1},s.elementsNeedMeasuring=!0,s.columns=t.observableArray([]),s.columns.subscribe(function(e){s.config.columnsChanged(e)}),s.renderedRows=t.observableArray([]),s.headerRow=null,s.rowHeight=s.config.rowHeight,s.jqueryUITheme=t.observable(s.config.jqueryUITheme),s.footer=null,s.selectedItems=s.config.selectedItems,s.multiSelect=s.config.multiSelect,s.footerVisible=o.kg.utils.isNullOrUndefined(s.config.displayFooter)?s.config.footerVisible:s.config.displayFooter,s.config.footerRowHeight=s.footerVisible?s.config.footerRowHeight:0,s.showColumnMenu=s.config.showColumnMenu,s.showMenu=t.observable(!1),s.configGroups=t.observableArray([]),s.enablePaging=s.config.enablePaging,s.pagingOptions=s.config.pagingOptions,s.rowTemplate=s.config.rowTemplate||o.kg.defaultRowTemplate(),s.headerRowTemplate=s.config.headerRowTemplate||o.kg.defaultHeaderRowTemplate(),s.config.rowTemplate&&!p.test(s.config.rowTemplate)&&(s.rowTemplate=o.kg.utils.getTemplatePromise(s.config.rowTemplate)),s.config.headerRowTemplate&&!p.test(s.config.headerRowTemplate)&&(s.headerRowTemplate=o.kg.utils.getTemplatePromise(s.config.headerRowTemplate)),s.visibleColumns=t.computed(function(){var e=s.columns();return e.filter(function(e){var t=e.visible();return t})}),s.nonAggColumns=t.computed(function(){return s.columns().filter(function(e){return!e.isAggCol})}),s.toggleShowMenu=function(){s.showMenu(!s.showMenu())},s.allSelected=s.config.selectAllState,s.allSelected.subscribe(function(e){s.config.beforeSelectionChange(s.sortedData.peek(),this)&&(s.selectionService.toggleSelectAll(e),s.config.afterSelectionChange(s.selectedItems.peek(),this))}),s.totalFilteredItemsLength=t.computed(function(){return s.filteredData().length}),s.showGroupPanel=t.computed(function(){return s.config.showGroupPanel}),s.topPanelHeight=t.observable(s.config.showGroupPanel===!0?2*s.config.headerRowHeight:s.config.headerRowHeight),s.viewportDimHeight=t.computed(function(){return Math.max(0,s.rootDim.outerHeight()-s.topPanelHeight()-s.config.footerRowHeight-2)}),s.groupBy=function(e){if(!(s.sortedData().length<1)){var t=s.configGroups().indexOf(e);t==-1?(e.isGroupedBy(!0),s.configGroups.push(e),e.groupIndex(s.configGroups().length)):s.removeGroup(t),o.kg.domUtilityService.BuildStyles(s)}},s.removeGroup=function(e){var t=s.columns().filter(function(t){return t.groupIndex()==e+1})[0];t.isGroupedBy(!1),
t.groupIndex(0),s.columns.splice(e,1),s.configGroups.splice(e,1),s.fixGroupIndexes(),0===s.configGroups().length&&s.fixColumnIndexes(),o.kg.domUtilityService.BuildStyles(s)},s.fixGroupIndexes=function(){e.each(s.configGroups(),function(e,t){t.groupIndex(e+1)})},s.totalRowWidth=function(){var t=0,o=s.visibleColumns();return e.each(o,function(e,o){t+=o.width}),t},s.headerScrollerDim=function(){var e=s.viewportDimHeight(),t=s.maxCanvasHt(),n=t>e,i=new o.kg.Dimension;return i.autoFitHeight=!0,i.outerWidth=s.totalRowWidth(),n?i.outerWidth+=s.elementDims.scrollW:t-e<=s.elementDims.scrollH&&(i.outerWidth+=s.elementDims.scrollW),i},s.jqueryUITheme=s.config.jqueryUITheme,s.maxRows=t.observable(Math.max(s.config.pagingOptions.totalServerItems()||s.sortedData().length,1)),s.maxRowsDisplay=t.computed(function(){return s.maxRows()}),s.multiSelect=t.observable(s.config.canSelectRows&&s.config.multiSelect),s.selectedItemCount=t.computed(function(){return s.selectedItems().length}),s.maxPages=t.computed(function(){return s.maxRows(Math.max(s.config.pagingOptions.totalServerItems()||s.sortedData().length,1)),Math.ceil(s.maxRows()/s.pagingOptions.pageSize())}),s.pageForward=function(){var e=s.config.pagingOptions.currentPage();s.config.pagingOptions.currentPage(Math.min(e+1,s.maxPages()))},s.pageBackward=function(){var e=s.config.pagingOptions.currentPage();s.config.pagingOptions.currentPage(Math.max(e-1,1))},s.pageToFirst=function(){s.config.pagingOptions.currentPage(1)},s.pageToLast=function(){var e=s.maxPages();s.config.pagingOptions.currentPage(e)},s.cantPageForward=t.computed(function(){var e=s.config.pagingOptions.currentPage(),t=s.maxPages();return!(e<t)}),s.cantPageBackward=t.computed(function(){var e=s.config.pagingOptions.currentPage();return!(e>1)}),s.init()},o.kg.Range=function(e,t){this.topRow=e,this.bottomRow=t},o.kg.Row=function(e,i,r){var a=this;a.canSelectRows=i.canSelectRows,a.rowClasses=i.rowClasses,a.selectedItems=i.selectedItems,a.entity=e,a.selectionService=r,a.selected=t.observable(!1),a.continueSelection=function(e){a.selectionService.ChangeSelection(a,e)},a.toggleSelected=function(e,t){if(!a.canSelectRows)return!0;var o=t.target||t;return"checkbox"==o.type&&a.selected(!a.selected()),!(!i.selectWithCheckboxOnly||"checkbox"==o.type)||!!a.beforeSelectionChange(a,t)&&(a.continueSelection(t),a.afterSelectionChange(a,t))},void 0===a.entity[n]?a.entity[n]=!1:a.selectionService.setSelection(a,a.entity[n]),a.rowIndex=t.observable(0),a.offsetTop=t.observable("0px"),a.rowDisplayIndex=0,a.isEven=t.computed(function(){return a.rowIndex()%2===0}),a.isOdd=t.computed(function(){return a.rowIndex()%2!==0}),a.beforeSelectionChange=i.beforeSelectionChangeCallback,a.afterSelectionChange=i.afterSelectionChangeCallback,a.propertyCache={},a.getProperty=function(e){return a.propertyCache[e]||(a.propertyCache[e]=o.kg.utils.evalProperty(a.entity,e))}},o.kg.RowFactory=function(t){var r=this;r.rowCache=[],r.aggCache=[],r.parentCache=[],r.dataChanged=!0,r.parsedData=[],r.rowConfig={},r.selectionService=t.selectionService,r.numberOfAggregates=0,r.groupedData=void 0,r.rowHeight=t.config.rowHeight,r.groupHeaderHeight=t.config.groupHeaderHeight,r.groupIndent=t.config.groupIndent,r.collapseGroups=t.config.collapseGroups,r.rowConfig={canSelectRows:t.config.canSelectRows,rowClasses:t.config.rowClasses,selectedItems:t.config.selectedItems,selectWithCheckboxOnly:t.config.selectWithCheckboxOnly,beforeSelectionChangeCallback:t.config.beforeSelectionChange,afterSelectionChangeCallback:t.config.afterSelectionChange},r.renderedRange=new o.kg.Range(0,t.minRowsToRender()+i),r.calculateAggRowOffsetTop=function(e,t){var o=e-t;return o*r.rowHeight+t*r.groupHeaderHeight},r.buildEntityRow=function(e,t){var i=r.rowCache[t];if(!i){i=new o.kg.Row(e,r.rowConfig,r.selectionService),i.rowIndex(t+1);var a=void 0===e[u]?r.rowHeight*t:r.calculateAggRowOffsetTop(t,e[u]+1);i.offsetTop(a.toString()+"px"),i.selected(e[n]),r.rowCache[t]=i}return i},r.buildAggregateRow=function(e,t){var n=r.aggCache[e.aggIndex];return n||(n=new o.kg.Aggregate(e,r),r.aggCache[e.aggIndex]=n),n.index=t+1,n.offsetTop(r.calculateAggRowOffsetTop(t,e.aggIndex).toString()+"px"),n},r.UpdateViewableRange=function(e){r.renderedRange=e,r.renderedChange()},r.filteredDataChanged=function(){t.lateBoundColumns&&t.filteredData().length>1&&(t.config.columnDefs=void 0,t.buildColumns(),t.lateBoundColumns=!1),r.dataChanged=!0,r.rowCache=[],t.config.groups.length>0&&r.getGrouping(t.config.groups),r.UpdateViewableRange(r.renderedRange)},r.renderedChange=function(){if(!r.groupedData||t.config.groups.length<1)return r.renderedChangeNoGroups(),void t.refreshDomSizes();r.parentCache=[];var o=[],n=r.parsedData.filter(function(e){return e[d]===!1}).slice(r.renderedRange.topRow,r.renderedRange.bottomRow);e.each(n,function(e,t){var n;n=t.isAggRow?r.buildAggregateRow(t,r.renderedRange.topRow+e):r.buildEntityRow(t,r.renderedRange.topRow+e),o.push(n)}),t.setRenderedRows(o),t.refreshDomSizes()},r.renderedChangeNoGroups=function(){var o=[],n=t.filteredData.slice(r.renderedRange.topRow,r.renderedRange.bottomRow);e.each(n,function(e,t){var n=r.buildEntityRow(t,r.renderedRange.topRow+e);o.push(n)}),t.setRenderedRows(o)},r.parseGroupData=function(t){if(t.values)e.each(t.values,function(e,t){r.parentCache[r.parentCache.length-1].children.push(t),t[u]=r.numberOfAggregates-1,r.parsedData.push(t)});else for(var o in t)if(o!=s&&o!=c&&o!=g&&t.hasOwnProperty(o)){var n={gField:t[s],gLabel:o,gDepth:t[c],isAggRow:!0,children:[],aggChildren:[],aggIndex:r.numberOfAggregates,aggLabelFilter:t[g].aggLabelFilter};n[d]=!1;var i=r.buildAggregateRow(n,0);r.numberOfAggregates++,i.parent=r.parentCache[i.depth-1],i.groupHeaderHeight=r.groupHeaderHeight,i.parent&&(i.parent.collapsed(!1),i.parent.aggChildren.push(i)),r.parsedData.push(i.entity),r.parentCache[i.depth]=i,r.parseGroupData(t[o])}},r.getGrouping=function(n){r.aggCache=[],r.rowCache=[],r.numberOfAggregates=0,r.groupedData={};var i=t.filteredData(),a=n.length,l=t.columns();e.each(i,function(i,u){u[d]=r.collapseGroups;var p=r.groupedData;e.each(n,function(e,n){r.groupIndent&&!l[e].isAggCol&&e<=a&&(t.columns.splice(u.gDepth,0,new o.kg.Column({colDef:{field:"",width:25,sortable:!1,resizable:!1,headerCellTemplate:'<div class="kgAggHeader"></div>'},isAggCol:!0,index:u.gDepth,headerRowHeight:t.config.headerRowHeight})),o.kg.domUtilityService.BuildStyles(t));var i=l.filter(function(e){return e.field==n})[0],d=o.kg.utils.evalProperty(u,n);i.cellFilter&&(d=i.cellFilter(d)),d=d?d.toString():"null",p[d]||(p[d]={}),p[s]||(p[s]=n),p[c]||(p[c]=e),p[g]||(p[g]=i),p=p[d]}),p.values||(p.values=[]),p.values.push(u)}),t.fixColumnIndexes(),r.parsedData.length=0,r.parseGroupData(r.groupedData)},r.calculateHeightOfAllRows=function(){var e=r.parsedData.filter(function(e){return e.isAggRow!==!0&&e[d]===!1}).length;return e*r.rowHeight+r.numberOfAggregates*r.groupHeaderHeight},t.config.groups.length>0&&t.filteredData().length>0&&r.getGrouping(t.config.groups)},o.kg.SearchProvider=function(o){var n,i=this,r=[];i.extFilter=o.config.filterOptions.useExternalFilter,i.showFilter=o.config.showFilter,i.filterText=o.config.filterOptions.filterText,i.throttle=o.config.filterOptions.filterThrottle,i.fieldMap={},i.evalFilter=function(){0===r.length?o.filteredData(o.sortedData.peek().filter(function(e){return!e._destroy})):o.filteredData(o.sortedData.peek().filter(function(e){if(e._destroy)return!1;for(var o=0,n=r.length;o<n;o++){var a=r[o];if(a.column){var l=t.utils.unwrapObservable(e[a.column])||t.utils.unwrapObservable(e[i.fieldMap[a.columnDisplay]]);if(l&&a.regex.test(l.toString()))return!0}else for(var s in e)if(e.hasOwnProperty(s)){var c=t.utils.unwrapObservable(e[s]);if(c&&a.regex.test(c.toString()))return!0}}return!1})),o.rowFactory.filteredDataChanged()};var a=function(e,t){try{return new RegExp(e,t)}catch(o){return new RegExp(e.replace(/(\^|\$|\(|\)|\[|\]|\{|\}|\\|\||\.|\*|\+|\?)/g,"\\$1"))}},l=function(t){r=[];var o;if(o=e.trim(t)){var n=o.split(";");e.each(n,function(t,o){var n=o.split(":");if(n.length>1){var i=e.trim(n[0]),l=e.trim(n[1]);i&&l&&r.push({column:i,columnDisplay:i.replace(/\s+/g,"").toLowerCase(),regex:a(l,"i")})}else{var s=e.trim(n[0]);s&&r.push({column:"",regex:a(s,"i")})}})}},s=t.computed(function(){var e=i.filterText();i.extFilter||e==n||(n=e,l(e),i.evalFilter())});"number"==typeof i.throttle&&s.extend({throttle:i.throttle}),i.extFilter||o.columns.subscribe(function(t){e.each(t,function(e,t){i.fieldMap[t.displayName().toLowerCase().replace(/\s+/g,"")]=t.field})})},o.kg.SelectionService=function(t){var o=this;o.multi=t.config.multiSelect,o.selectedItems=t.config.selectedItems,o.selectedIndex=t.config.selectedIndex,o.lastClickedRow=void 0,o.ignoreSelectedItemChanges=!1,o.rowFactory={},o.Initialize=function(e){o.rowFactory=e},o.ChangeSelection=function(i,r){if(t.$$selectionPhase=!0,r&&r.shiftKey&&o.multi){if(o.lastClickedRow){var a=t.filteredData.indexOf(i.entity),l=t.filteredData.indexOf(o.lastClickedRow.entity);if(a==l)return t.$$selectionPhase=!1,!1;l++,a<l&&(a^=l,l=a^l,a^=l);for(var s=[];l<=a;l++)s.push(o.rowFactory.rowCache[l]);s[s.length-1].beforeSelectionChange(s,r)&&(e.each(s,function(e,t){t.selected(!0),t.entity[n]=!0,o.selectedItems.indexOf(t.entity)===-1&&o.selectedItems.push(t.entity)}),s[s.length-1].afterSelectionChange(s,r))}}else o.multi?o.setSelection(i,!i.selected()):(o.lastClickedRow&&o.lastClickedRow!=i&&o.setSelection(o.lastClickedRow,!1),o.setSelection(i,!!t.config.keepLastSelected||!i.selected()));return o.lastClickedRow=i,t.$$selectionPhase=!1,!0},o.setSelection=function(e,t){e.selected(t),e.entity[n]=t,t?o.selectedItems.indexOf(e.entity)===-1&&o.selectedItems.push(e.entity):o.selectedItems.remove(e.entity)},o.toggleSelectAll=function(i){var r=o.selectedItems().length;r>0&&o.selectedItems.splice(0,r),e.each(t.filteredData(),function(e,t){t[n]=i,i&&o.selectedItems.push(t)}),e.each(o.rowFactory.rowCache,function(e,t){t&&t.selected&&t.selected(i)})}},o.kg.sortService={colSortFnCache:{},dateRE:/^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)$/,guessSortFn:function(e){var t,n,i,r,a;if(void 0===e||null===e||""===e)return null;switch(n=typeof e){case"number":t=o.kg.sortService.sortNumber;break;case"boolean":t=o.kg.sortService.sortBool;break;default:t=void 0}return t?t:"[object Date]"===Object.prototype.toString.call(e)?o.kg.sortService.sortDate:"string"!==n?o.kg.sortService.basicSort:e.match(/^-?[£$¤]?[\d,.]+%?$/)?o.kg.sortService.sortNumberStr:(i=e.match(o.kg.sortService.dateRE),i?(r=parseInt(i[1],10),a=parseInt(i[2],10),r>12?o.kg.sortService.sortDDMMStr:a>12?o.kg.sortService.sortMMDDStr:o.kg.sortService.sortMMDDStr):o.kg.sortService.sortAlpha)},basicSort:function(e,t){return e==t?0:e<t?-1:1},sortNumber:function(e,t){return e-t},sortNumberStr:function(e,t){var o,n,i=!1,r=!1;return o=parseFloat(e.replace(/[^0-9.-]/g,"")),isNaN(o)&&(i=!0),n=parseFloat(t.replace(/[^0-9.-]/g,"")),isNaN(n)&&(r=!0),i&&r?0:i?1:r?-1:o-n},sortAlpha:function(e,t){var o=e.toLowerCase(),n=t.toLowerCase();return o==n?0:o<n?-1:1},sortBool:function(e,t){return e&&t?0:e||t?e?1:-1:0},sortDate:function(e,t){var o=e.getTime(),n=t.getTime();return o==n?0:o<n?-1:1},sortDDMMStr:function(e,t){var n,i,r,a,l,s;return r=e.match(o.kg.sortService.dateRE),s=r[3],a=r[2],l=r[1],1==a.length&&(a="0"+a),1==l.length&&(l="0"+l),n=s+a+l,r=t.match(o.kg.sortService.dateRE),s=r[3],a=r[2],l=r[1],1==a.length&&(a="0"+a),1==l.length&&(l="0"+l),i=s+a+l,n==i?0:n<i?-1:1},sortMMDDStr:function(e,t){var n,i,r,a,l,s;return r=e.match(o.kg.sortService.dateRE),s=r[3],l=r[2],a=r[1],1==a.length&&(a="0"+a),1==l.length&&(l="0"+l),n=s+a+l,r=t.match(o.kg.sortService.dateRE),s=r[3],l=r[2],a=r[1],1==a.length&&(a="0"+a),1==l.length&&(l="0"+l),i=s+a+l,n==i?0:n<i?-1:1},sortData:function(e,t){var n=e();if(n&&t){var i,r,l=t.column,s=t.direction;if(o.kg.sortService.colSortFnCache[l.field])i=o.kg.sortService.colSortFnCache[l.field];else if(void 0!=l.sortingAlgorithm)i=l.sortingAlgorithm,o.kg.sortService.colSortFnCache[l.field]=l.sortingAlgorithm;else{if(r=n[0],!r)return;i=o.kg.sortService.guessSortFn(r[l.field]),i?o.kg.sortService.colSortFnCache[l.field]=i:i=o.kg.sortService.sortAlpha}n.sort(function(e,t){var n=o.kg.utils.evalProperty(e,l.field),r=o.kg.utils.evalProperty(t,l.field);return r||n?n?r?s===a?i(n,r):0-i(n,r):-1:1:0}),e(n)}},Sort:function(e,t){o.kg.sortService.isSorting||(o.kg.sortService.isSorting=!0,o.kg.sortService.sortData(t,e),o.kg.sortService.isSorting=!1)}},o.kg.StyleProvider=function(e){e.canvasStyle=t.computed(function(){return{height:e.maxCanvasHt().toString()+"px"}}),e.headerScrollerStyle=t.computed(function(){return{height:e.config.headerRowHeight+"px"}}),e.topPanelStyle=t.computed(function(){return{width:e.rootDim.outerWidth()+"px",height:e.topPanelHeight()+"px"}}),e.headerStyle=t.computed(function(){return{width:Math.max(0,e.rootDim.outerWidth()-o.kg.domUtilityService.ScrollW)+"px",height:e.config.headerRowHeight+"px"}}),e.viewportStyle=t.computed(function(){return{width:e.rootDim.outerWidth()+"px",height:e.viewportDimHeight()+"px"}}),e.footerStyle=t.computed(function(){return{width:e.rootDim.outerWidth()+"px",height:e.config.footerRowHeight+"px"}})}}(window)});