/***********************************************
* koGrid JavaScript Library
* Authors: https://github.com/ericmbarnard/koGrid/blob/master/README.md
* License: MIT (http://www.opensource.org/licenses/mit-license.php)
* Compiled At: 12/19/2012 10:15:47
***********************************************/
(function(e){"use strict";if(!e.kg){e.kg={}}e.kg.numberOfGrids=0;e.kg.eventStorage={};var t="__kg_selected__",n="__koGrid__",r=8,i=6,s="asc",o="desc",u="_kg_field_",a="_kg_depth_",f="_kg_hidden_",l="_kg_column_",c=/<.+>/;e.kg.moveSelectionHandler=function(t,n){if(e.kg.utils.isNullOrUndefined(t)||e.kg.utils.isNullOrUndefined(t.config.selectedItems)){return true}var i=n.which||n.keyCode,s=i===38?-1:i===40?1:null;if(!s){return true}var o=t.renderedRows(),u=o.indexOf(t.selectionService.lastClickedRow)+s;if(u<0||u>=o.length){return true}t.selectionService.ChangeSelection(o[u],n);if(u>o.length-r){t.$viewport.scrollTop(t.$viewport.scrollTop()+t.config.rowHeight*r)}else if(u<r){t.$viewport.scrollTop(t.$viewport.scrollTop()-t.config.rowHeight*r)}return false};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e){var t=this.length>>>0;var n=Number(arguments[1])||0;n=n<0?Math.ceil(n):Math.floor(n);if(n<0){n+=t}for(;n<t;n++){if(n in this&&this[n]===e){return n}}return-1}}if(!Array.prototype.filter){Array.prototype.filter=function(e){"use strict";var t=Object(this),n=t.length>>>0;if(typeof e!=="function"){throw new TypeError}var r=[];var i=arguments[1];for(var s=0;s<n;s++){if(s in t){var o=t[s];if(e.call(i,o,s,t)){r.push(o)}}}return r}}e.kg.utils={visualLength:function(e){var t=document.getElementById("testDataLength");if(!t){t=document.createElement("SPAN");t.id="testDataLength";t.style.visibility="hidden";document.body.appendChild(t)}$(t).css("font",$(e).css("font"));t.innerHTML=$(e).text();return t.offsetWidth},forIn:function(e,t){for(var n in e){if(e.hasOwnProperty(n)){t(e[n],n)}}},evalProperty:function(e,t){var n=ko.utils.unwrapObservable(e);var r=t.split("."),i=0;var s=ko.utils.unwrapObservable(n[r[i]]),o=r.length;i++;while(s&&i<o){s=ko.utils.unwrapObservable(s[r[i]]);i++}return s},endsWith:function(e,t){if(!e||!t||typeof e!="string"){return false}return e.indexOf(t,e.length-t.length)!==-1},isNullOrUndefined:function(e){if(e===undefined||e===null){return true}return false},getElementsByClassName:function(e){var t=[];var n=new RegExp("\\b"+e+"\\b");var r=document.getElementsByTagName("*");for(var i=0;i<r.length;i++){var s=r[i].className;if(n.test(s)){t.push(r[i])}}return t},getTemplatePromise:function(e){return $.ajax(e)},newId:function(){var e=(new Date).getTime();return function(){return e+=1}}(),ieVersion:function(){var e=3,t=document.createElement("div"),n=t.getElementsByTagName("i");while(t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",n[0]);return e>4?e:undefined}()};$.extend(e.kg.utils,{isIe6:function(){return e.kg.utils.ieVersion===6}(),isIe7:function(){return e.kg.utils.ieVersion===7}(),isIe:function(){return e.kg.utils.ieVersion!==undefined}()});e.kg.defaultGridTemplate=function(){return'<div data-bind="css: {\'ui-widget\': jqueryUITheme, \'kgNoSelect\' : disableTextSelection}"><div class="kgTopPanel" data-bind="css: {\'ui-widget-header\':jqueryUITheme, \'ui-corner-top\': jqueryUITheme}, style: $data.topPanelStyle"><div class="kgGroupPanel" data-bind="visible: $data.showGroupPanel, style: headerStyle"><div class="kgGroupPanelDescription" data-bind="visible: configGroups().length == 0">Drag a column header here and drop it to group by that column</div><ul data-bind="visible: configGroups().length > 0, foreach: configGroups" class="kgGroupList"><li class="kgGroupItem"><span class="kgGroupElement"><div class="kgGroupName"><span data-bind="text: displayName"></span><span data-bind="click: function(data) { $root.removeGroup($index()) }" class="kgRemoveGroup">x</span></div><span data-bind="visible: $index() < ($root.configGroups().length - 1)" class="kgGroupArrow"></span></span></li></ul></div><div class="kgHeaderContainer" data-bind="style: headerStyle"><div class="kgHeaderScroller" data-bind="style: headerScrollerStyle, kgHeaderRow: $data" ></div></div><div class="kgHeaderButton" data-bind="visible: ($data.showColumnMenu || $data.showFilter), click: toggleShowMenu"><div class="kgHeaderButtonArrow"></div></div><div data-bind="visible: showMenu" class="kgColMenu"><div data-bind="visible: showFilter"><input placeholder="Search Field:Value" type="text" data-bind="value: filterText, valueUpdate: \'afterkeydown\'"/></div><div data-bind="visible: showColumnMenu"><span class="kgMenuText">Choose Columns:</span><ul class="kgColList" data-bind="foreach: nonAggColumns"><li class="kgColListItem"><label style="position: relative;"><input type="checkbox" class="kgColListCheckbox" data-bind="checked: visible"/><span data-bind="text: displayName, click: toggleVisible"></span><a title="Group By" data-bind="attr: {\'class\': groupedByClass }, visible: (field != \'✔\'), click: $parent.groupBy"></a><span class="kgGroupingNumber" data-bind="visible: groupIndex() > 0, text: groupIndex"></span></label></li></ul></div></div></div><div class="kgViewport" data-bind="css: {\'ui-widget-content\': jqueryUITheme}, style: viewportStyle"><div class="kgCanvas" data-bind="style: canvasStyle"><div data-bind="foreach: renderedRows" style="position: absolute;"><div data-bind="style: { \'top\': offsetTop, \'height\': $parent.rowHeight + \'px\' }, click: toggleSelected, css: {\'selected\': selected, \'even\': isEven , \'odd\': isOdd, \'ui-state-default\': $parent.jqueryUITheme && isOdd, \'ui-state-active\':$parent.jqueryUITheme && isEven}, kgRow: $data" class="kgRow"></div></div></div></div><div class="kgFooterPanel" data-bind="css: {\'ui-widget-content\': jqueryUITheme, \'ui-corner-bottom\': jqueryUITheme}, style: footerStyle"><div class="kgTotalSelectContainer" data-bind="visible: footerVisible"><div class="kgFooterTotalItems" data-bind="css: {\'kgNoMultiSelect\': !multiSelect}" ><span class="kgLabel">Total Items: <span data-bind="text: maxRowsDisplay"></span></span><span data-bind="visible: filterText().length > 0" class="kgLabel">(Showing: <span data-bind="text: totalFilteredItemsLength"></span>)</span></div><div class="kgFooterSelectedItems" data-bind="visible: multiSelect"><span class="kgLabel">Selected Items: <span data-bind="text: selectedItemCount"></span></span></div></div><div class="kgPagerContainer" style="float: right; margin-top: 10px;" data-bind="visible: (footerVisible && enablePaging), css: {\'kgNoMultiSelect\': !multiSelect}"><div style="float:left; margin-right: 10px;" class="kgRowCountPicker"><span style="float: left; margin-top: 3px;" class="kgLabel">Page Size:</span><select style="float: left;height: 27px; width: 100px" data-bind="value: pagingOptions.pageSize, options: pagingOptions.pageSizes"></select></div><div style="float:left; margin-right: 10px; line-height:25px;" class="kgPagerControl" style="float: left; min-width: 135px;"><button class="kgPagerButton" data-bind="click: pageToFirst, disable: cantPageBackward()" title="First Page"><div class="kgPagerFirstTriangle"><div class="kgPagerFirstBar"></div></div></button><button class="kgPagerButton" data-bind="click: pageBackward, disable: cantPageBackward()" title="Previous Page"><div class="kgPagerFirstTriangle kgPagerPrevTriangle"></div></button><input class="kgPagerCurrent" type="number" style="width:50px; height: 24px; margin-top: 1px; padding: 0px 4px;" data-bind="value: pagingOptions.currentPage, valueUpdate: \'afterkeydown\'"/><button class="kgPagerButton" data-bind="click: pageForward, disable: cantPageForward()" title="Next Page"><div class="kgPagerLastTriangle kgPagerNextTriangle"></div></button><button class="kgPagerButton" data-bind="click: pageToLast, disable: cantPageForward()" title="Last Page"><div class="kgPagerLastTriangle"><div class="kgPagerLastBar"></div></div></button></div></div></div></div>'};e.kg.defaultRowTemplate=function(){return"<div data-bind=\"style: { cursor : canSelectRows ? 'pointer' : 'default' }, foreach: $grid.visibleColumns, css: { 'ui-widget-content': $grid.jqueryUITheme }\"><div data-bind=\"attr: { 'class': cellClass() + ' kgCell col' + $index() }, kgCell: $data\"></div></div>"};e.kg.defaultCellTemplate=function(){return"<div data-bind=\"attr: { 'class': 'kgCellText colt' + $index()}, html: $data.getProperty($parent)\"></div>"};e.kg.aggregateTemplate=function(){return'<div data-bind="click: toggleExpand, style: {\'left\': offsetLeft()}" class="kgAggregate"><span class="kgAggregateText" data-bind="html: $data.label">(<span data-bind="html: totalChildren"></span> Items)</span><div data-bind="attr: {\'class\' : aggClass }"></div></div>'};e.kg.defaultHeaderRowTemplate=function(){return"<div data-bind=\"foreach: visibleColumns\"><div data-bind=\"kgHeaderCell: $data, attr: { 'class': 'kgHeaderCell col' + $index() }\"></div></div>"};e.kg.defaultHeaderCellTemplate=function(){return"<div data-bind=\"style: { cursor : sortable() ? 'pointer' : 'default' }, click: sort, css: {'kgSorted': !noSortVisible }, attr: {'class': 'kgHeaderSortColumn ' + headerClass()}\"><div data-bind=\"attr: { 'class': 'colt' + $index() + ' kgHeaderText' }, html: displayName\"></div><div class=\"kgSortButtonDown\" data-bind=\"visible: showSortButtonDown\"></div><div class=\"kgSortButtonUp\" data-bind=\"visible: showSortButtonUp\"></div><div data-bind=\"visible: resizable, click: gripClick, mouseEvents: { mouseDown: gripOnMouseDown }\" class=\"kgHeaderGrip\" ></div></div>"};ko.bindingHandlers["koGrid"]=function(){return{init:function(t,n,r,i,s){var o=n();var u=$(t);o.gridDim=new e.kg.Dimension({outerHeight:ko.observable(u.height()),outerWidth:ko.observable(u.width())});var a=new e.kg.Grid(o);var f=$(e.kg.defaultGridTemplate());o.data.subscribe(function(){if(a.$$selectionPhase){return}a.searchProvider.evalFilter();a.refreshDomSizes()});if(ko.isObservable(o.columnDefs)){o.columnDefs.subscribe(function(e){a.columns([]);a.config.columnDefs=e;a.buildColumns();a.configureColumnWidths()})}u.addClass("koGrid").addClass(a.gridId.toString());u.append(f);a.$userViewModel=s.$data;ko.applyBindings(a,f[0]);e.kg.domUtilityService.AssignGridContainers(u,a);a.configureColumnWidths();a.refreshDomSizes();a.eventProvider=new e.kg.EventProvider(a);$.each(a.config.plugins,function(e,t){if(typeof t.onGridInit==="function"){t.onGridInit(a)}});e.kg.domUtilityService.BuildStyles(a);return{controlsDescendantBindings:true}}}}();ko.bindingHandlers["kgRow"]=function(){return{init:function(t,n,r,i,s){var o=n();var u=o.$grid=s.$parent;var a;if(o.isAggRow){a=e.kg.aggregateTemplate()}else{a=u.rowTemplate}var f=function(e){var n=$(e);o.$userViewModel=s.$parent.$userViewModel;ko.applyBindings(o,n[0]);$(t).html(n)};if(a.then){a.then(function(e){f(e)})}else{f(a)}return{controlsDescendantBindings:true}}}}();ko.bindingHandlers["kgCell"]=function(){return{init:function(e,t,n,r,i){i.$userViewModel=i.$parent.$userViewModel;var s=function(t){var n=$(t);ko.applyBindings(i,n[0]);$(e).html(n)};if(r.cellTemplate.then){r.cellTemplate.then(function(e){s(e)})}else{s(r.cellTemplate)}return{controlsDescendantBindings:true}}}}();ko.bindingHandlers["kgHeaderRow"]=function(){return{init:function(e,t,n,r,i){i.$userViewModel=i.$data.$userViewModel;var s=function(t){var n=$(t);ko.applyBindings(i,n[0]);$(e).html(n)};if(r.headerRowTemplate.then){r.headerRowTemplate.then(function(e){s(e)})}else{s(r.headerRowTemplate)}return{controlsDescendantBindings:true}}}}();ko.bindingHandlers["kgHeaderCell"]=function(){return{init:function(e,t,n,r,i){var s=i.extend({$grid:i.$parent,$userViewModel:i.$parent.$userViewModel});var o=function(t){var n=$(t);ko.applyBindings(s,n[0]);$(e).html(n)};if(r.headerCellTemplate.then){r.headerCellTemplate.then(function(e){o(e)})}else{o(r.headerCellTemplate)}return{controlsDescendantBindings:true}}}}();ko.bindingHandlers["mouseEvents"]=function(){return{init:function(e,t,n,r,i){var s=t();if(s.mouseDown){$(e).mousedown(s.mouseDown)}}}}();e.kg.Aggregate=function(e,t){var n=this;n.index=0;n.offsetTop=ko.observable(0);n.entity=e;n.label=ko.observable(e.gLabel);n.field=e.gField;n.depth=e.gDepth;n.parent=e.parent;n.children=e.children;n.aggChildren=e.aggChildren;n.aggIndex=e.aggIndex;n.collapsed=ko.observable(true);n.isAggRow=true;n.offsetLeft=ko.observable((e.gDepth*25).toString()+"px");n.aggLabelFilter=e.aggLabelFilter;n.toggleExpand=function(){var e=n.collapsed();n.collapsed(!e);n.notifyChildren()};n.setExpand=function(e){n.collapsed(e);n.notifyChildren()};n.notifyChildren=function(){$.each(n.aggChildren,function(e,t){t.entity[f]=n.collapsed();if(n.collapsed()){var r=n.collapsed();t.setExpand(r)}});$.each(n.children,function(e,t){t[f]=n.collapsed()});t.rowCache=[];var e=false;$.each(t.aggCache,function(t,r){if(e){var i=30*n.children.length;var s=n.collapsed();r.offsetTop(s?r.offsetTop()-i:r.offsetTop()+i)}else{if(t==n.aggIndex){e=true}}});t.renderedChange()};n.aggClass=ko.computed(function(){return n.collapsed()?"kgAggArrowCollapsed":"kgAggArrowExpanded"});n.totalChildren=ko.computed(function(){if(n.aggChildren.length>0){var e=0;var t=function(n){if(n.aggChildren.length>0){$.each(n.aggChildren,function(e,n){t(n)})}else{e+=n.children.length}};t(n);return e}else{return n.children.length}});n.selected=ko.observable(false);n.isEven=ko.observable(false);n.isOdd=ko.observable(false);n.toggleSelected=function(){return true}};e.kg.Column=function(t,n){var r=this,i=t.colDef,u=500,a=0,f=null;r.eventTaget=undefined;r.width=i.width;r.groupIndex=ko.observable(0);r.isGroupedBy=ko.observable(false);r.groupedByClass=ko.computed(function(){return r.isGroupedBy()?"kgGroupedByIcon":"kgGroupIcon"});r.sortable=ko.observable(false);r.resizable=ko.observable(false);r.minWidth=!i.minWidth?50:i.minWidth;r.maxWidth=!i.maxWidth?9e3:i.maxWidth;r.headerRowHeight=t.headerRowHeight;r.displayName=ko.observable(i.displayName||i.field);r.index=t.index;r.isAggCol=t.isAggCol;r.cellClass=ko.observable(i.cellClass||"");r.cellFilter=i.cellFilter||i.cellFormatter;r.field=i.field;r.aggLabelFilter=i.cellFilter||i.cellFormatter||i.aggLabelFilter||i.aggLabelFormatter;r._visible=ko.observable(e.kg.utils.isNullOrUndefined(i.visible)||i.visible);r.visible=ko.computed({read:function(){return r._visible()},write:function(e){r.toggleVisible(e)}});if(t.enableSort){r.sortable(e.kg.utils.isNullOrUndefined(i.sortable)||i.sortable)}if(t.enableResize){r.resizable(e.kg.utils.isNullOrUndefined(i.resizable)||i.resizable)}r.sortDirection=ko.observable(undefined);r.sortingAlgorithm=i.sortFn;r.headerClass=ko.observable(i.headerClass);r.headerCellTemplate=i.headerCellTemplate||e.kg.defaultHeaderCellTemplate();r.cellTemplate=i.cellTemplate||e.kg.defaultCellTemplate();if(i.cellTemplate&&!c.test(i.cellTemplate)){r.cellTemplate=e.kg.utils.getTemplatePromise(i.cellTemplate)}if(i.headerCellTemplate&&!c.test(i.headerCellTemplate)){r.headerCellTemplate=e.kg.utils.getTemplatePromise(i.headerCellTemplate)}r.getProperty=function(e){var t;if(r.cellFilter){t=r.cellFilter(e.getProperty(r.field))}else{t=e.getProperty(r.field)}return t};r.toggleVisible=function(t){var i;if(e.kg.utils.isNullOrUndefined(t)||typeof t=="object"){i=!r._visible()}else{i=t}r._visible(i);e.kg.domUtilityService.BuildStyles(n)};r.showSortButtonUp=ko.computed(function(){return r.sortable?r.sortDirection()===o:r.sortable});r.showSortButtonDown=ko.computed(function(){return r.sortable?r.sortDirection()===s:r.sortable});r.noSortVisible=ko.computed(function(){return!r.sortDirection()});r.sort=function(){if(!r.sortable()){return true}var e=r.sortDirection()===s?o:s;r.sortDirection(e);t.sortCallback(r,e);return false};r.gripClick=function(e,n){n.stopPropagation();a++;if(a===1){f=setTimeout(function(){a=0},u)}else{clearTimeout(f);t.resizeOnDataCallback(r);a=0}};r.gripOnMouseDown=function(t){t.stopPropagation();if(t.ctrlKey){r.toggleVisible();e.kg.domUtilityService.BuildStyles(n);n.config.columnsChanged(n.columns.peek());return true}r.eventTaget=t.target.parentElement;r.eventTaget.style.cursor="col-resize";r.startMousePosition=t.clientX;r.origWidth=r.width;$(document).mousemove(r.onMouseMove);$(document).mouseup(r.gripOnMouseUp);return false};r.onMouseMove=function(t){t.stopPropagation();var i=t.clientX-r.startMousePosition;var s=i+r.origWidth;r.width=s<r.minWidth?r.minWidth:s>r.maxWidth?r.maxWidth:s;e.kg.domUtilityService.BuildStyles(n);return false};r.gripOnMouseUp=function(e){e.stopPropagation();$(document).off("mousemove");$(document).off("mouseup");r.eventTaget.style.cursor=r.sortable()?"pointer":"default";r.eventTaget=undefined;n.config.columnsChanged(n.columns.peek());return false}};e.kg.Dimension=function(e){this.outerHeight=null;this.outerWidth=null;$.extend(this,e)};e.kg.EventProvider=function(t){var n=this;n.colToMove=undefined;n.groupToMove=undefined;n.assignEvents=function(){if(t.config.jqueryUIDraggable){t.$groupPanel.droppable({addClasses:false,drop:function(e){n.onGroupDrop(e)}});$(document).ready(n.setDraggables)}else{t.$groupPanel.on("mousedown",n.onGroupMouseDown).on("dragover",n.dragOver).on("drop",n.onGroupDrop);t.$headerScroller.on("mousedown",n.onHeaderMouseDown).on("dragover",n.dragOver).on("drop",n.onHeaderDrop);if(t.config.enableRowReordering){t.$viewport.on("mousedown",n.onRowMouseDown).on("dragover",n.dragOver).on("drop",n.onRowDrop)}n.setDraggables()}t.columns.subscribe(n.setDraggables)};n.dragOver=function(e){e.preventDefault()};n.setDraggables=function(){if(!t.config.jqueryUIDraggable){t.$root.find(".kgHeaderSortColumn").attr("draggable","true");if(navigator.userAgent.indexOf("MSIE")!=-1){t.$root.find(".kgHeaderSortColumn").bind("selectstart",function(){this.dragDrop();return false})}}else{t.$root.find(".kgHeaderSortColumn").draggable({helper:"clone",appendTo:"body",stack:"div",addClasses:false,start:function(e){n.onHeaderMouseDown(e)}}).droppable({drop:function(e){n.onHeaderDrop(e)}})}};n.onGroupMouseDown=function(e){var r=$(e.target);if(r[0].className!="kgRemoveGroup"){var i=ko.dataFor(r[0]);if(i){if(!t.config.jqueryUIDraggable){r.attr("draggable","true")}n.groupToMove={header:r,groupName:i,index:i.groupIndex()-1}}}else{n.groupToMove=undefined}};n.onGroupDrop=function(e){var r;var i;if(n.groupToMove){r=$(e.target).closest(".kgGroupElement");if(r.context.className=="kgGroupPanel"){t.configGroups.splice(n.groupToMove.index,1);t.configGroups.push(n.groupToMove.groupName)}else{i=ko.dataFor(r[0]);if(i){if(n.groupToMove.index!=i.groupIndex()){t.configGroups.splice(n.groupToMove.index,1);t.configGroups.splice(i.groupIndex(),0,n.groupToMove.groupName)}}}n.groupToMove=undefined;t.fixGroupIndexes()}else{if(t.configGroups.indexOf(n.colToMove.col)==-1){r=$(e.target).closest(".kgGroupElement");if(r.context.className=="kgGroupPanel"||r.context.className=="kgGroupPanelDescription"){t.groupBy(n.colToMove.col)}else{i=ko.dataFor(r[0]);if(i){t.removeGroup(i.groupIndex())}}}n.colToMove=undefined}};n.onHeaderMouseDown=function(e){var t=$(e.target).closest(".kgHeaderSortColumn");if(!t[0]){return true}var r=ko.dataFor(t[0]);if(r){n.colToMove={header:t,col:r}}return true};n.onHeaderDrop=function(r){if(!n.colToMove){return true}var i=$(r.target).closest(".kgHeaderSortColumn");if(!i[0]){return true}var s=ko.dataFor(i[0]);if(s){if(n.colToMove.col==s){return true}var o=t.columns.peek();o.splice(n.colToMove.col.index,1);o.splice(s.index,0,n.colToMove.col);t.fixColumnIndexes();t.columns(o);e.kg.domUtilityService.BuildStyles(t);n.colToMove=undefined}return true};n.onRowMouseDown=function(t){var n=$(t.target).closest(".kgRow");if(!n[0]){return}var r=ko.dataFor(n[0]);if(r){n.attr("draggable","true");e.kg.eventStorage.rowToMove={targetRow:n,scope:r}}};n.onRowDrop=function(n){var r=$(n.target).closest(".kgRow");var i=ko.dataFor(r[0]);if(i){var s=e.kg.eventStorage.rowToMove;if(s.scope==i){return}var o=t.sortedData();var u=o.indexOf(s.scope.entity);var a=o.indexOf(i.entity);t.sortedData.splice(u,1);t.sortedData.splice(a,0,s.scope.entity);t.searchProvider.evalFilter();e.kg.eventStorage.rowToMove=undefined}};n.assignGridEventHandlers=function(){t.$viewport.scroll(function(e){var n=e.target.scrollLeft,r=e.target.scrollTop;t.adjustScrollLeft(n);t.adjustScrollTop(r)});t.$viewport.off("keydown");t.$viewport.on("keydown",function(n){return e.kg.moveSelectionHandler(t,n)});if(t.config.tabIndex===-1){t.$viewport.attr("tabIndex",e.kg.numberOfGrids);e.kg.numberOfGrids++}else{t.$viewport.attr("tabIndex",t.config.tabIndex)}$(e).resize(function(){e.kg.domUtilityService.UpdateGridLayout(t);if(t.config.maintainColumnRatios){t.configureColumnWidths()}})};n.assignGridEventHandlers();n.assignEvents()};e.kg.RowFactory=function(n){var i=this;i.rowCache=[];i.aggCache={};i.parentCache=[];i.dataChanged=true;i.parsedData=[];i.rowConfig={};i.selectionService=n.selectionService;i.rowHeight=30;i.numberOfAggregates=0;i.groupedData=undefined;i.rowHeight=n.config.rowHeight;i.rowConfig={canSelectRows:n.config.canSelectRows,rowClasses:n.config.rowClasses,selectedItems:n.config.selectedItems,selectWithCheckboxOnly:n.config.selectWithCheckboxOnly,beforeSelectionChangeCallback:n.config.beforeSelectionChange,afterSelectionChangeCallback:n.config.afterSelectionChange};i.renderedRange=new e.kg.Range(0,n.minRowsToRender()+r);i.buildEntityRow=function(n,r){var s=i.rowCache[r];if(!s){s=new e.kg.Row(n,i.rowConfig,i.selectionService);s.rowIndex(r+1);s.offsetTop((i.rowHeight*r).toString()+"px");s.selected(n[t]);i.rowCache[r]=s}return s};i.buildAggregateRow=function(t,n){var r=i.aggCache[t.aggIndex];if(!r){r=new e.kg.Aggregate(t,i);i.aggCache[t.aggIndex]=r}r.index=n+1;r.offsetTop((i.rowHeight*n).toString()+"px");return r};i.UpdateViewableRange=function(e){i.renderedRange=e;i.renderedChange()};i.filteredDataChanged=function(){if(n.lateBoundColumns&&n.filteredData().length>1){n.config.columnDefs=undefined;n.buildColumns();n.lateBoundColumns=false}i.dataChanged=true;i.rowCache=[];if(n.config.groups.length>0){i.getGrouping(n.config.groups)}i.UpdateViewableRange(i.renderedRange)};i.renderedChange=function(){if(!i.groupedData||n.config.groups.length<1){i.renderedChangeNoGroups();n.refreshDomSizes();return}i.parentCache=[];var e=[];var t=i.parsedData.filter(function(e){return e[f]===false}).slice(i.renderedRange.topRow,i.renderedRange.bottomRow);$.each(t,function(t,n){var r;if(n.isAggRow){r=i.buildAggregateRow(n,i.renderedRange.topRow+t)}else{r=i.buildEntityRow(n,i.renderedRange.topRow+t)}e.push(r)});n.setRenderedRows(e);n.refreshDomSizes()};i.renderedChangeNoGroups=function(){var e=[];var t=n.filteredData.slice(i.renderedRange.topRow,i.renderedRange.bottomRow);$.each(t,function(t,n){var r=i.buildEntityRow(n,i.renderedRange.topRow+t);e.push(r)});n.setRenderedRows(e)};i.parseGroupData=function(e){if(e.values){$.each(e.values,function(e,t){i.parentCache[i.parentCache.length-1].children.push(t);i.parsedData.push(t)})}else{for(var t in e){if(t==u||t==a||t==l){continue}else if(e.hasOwnProperty(t)){var n=i.buildAggregateRow({gField:e[u],gLabel:t,gDepth:e[a],isAggRow:true,_kg_hidden_:false,children:[],aggChildren:[],aggIndex:i.numberOfAggregates,aggLabelFilter:e[l].aggLabelFilter},0);i.numberOfAggregates++;n.parent=i.parentCache[n.depth-1];if(n.parent){n.parent.collapsed(false);n.parent.aggChildren.push(n)}i.parsedData.push(n.entity);i.parentCache[n.depth]=n;i.parseGroupData(e[t])}}}};i.getGrouping=function(t){i.aggCache=[];i.rowCache=[];i.numberOfAggregates=0;i.groupedData={};var r=n.filteredData();var s=t.length;var o=n.columns();$.each(r,function(r,c){c[f]=true;var h=i.groupedData;$.each(t,function(t,r){if(!o[t].isAggCol&&t<=s){n.columns.splice(c.gDepth,0,new e.kg.Column({colDef:{field:"",width:25,sortable:false,resizable:false,headerCellTemplate:'<div class="kgAggHeader"></div>'},isAggCol:true,index:c.gDepth,headerRowHeight:n.config.headerRowHeight}));e.kg.domUtilityService.BuildStyles(n)}var i=o.filter(function(e){return e.field==r})[0];var f=e.kg.utils.evalProperty(c,r);if(i.cellFilter){f=i.cellFilter(f)}f=f?f.toString():"null";if(!h[f]){h[f]={}}if(!h[u]){h[u]=r}if(!h[a]){h[a]=t}if(!h[l]){h[l]=i}h=h[f]});if(!h.values){h.values=[]}h.values.push(c)});n.fixColumnIndexes();i.parsedData.length=0;i.parseGroupData(i.groupedData)};if(n.config.groups.length>0&&n.filteredData().length>0){i.getGrouping(n.config.groups)}};e.kg.Grid=function(n){var s={rowHeight:30,columnWidth:100,headerRowHeight:30,footerRowHeight:55,footerVisible:true,displayFooter:undefined,canSelectRows:true,selectAllState:ko.observable(false),data:ko.observableArray([]),columnDefs:undefined,selectedItems:ko.observableArray([]),displaySelectionCheckbox:true,selectWithCheckboxOnly:false,useExternalSorting:false,sortInfo:ko.observable(undefined),multiSelect:true,tabIndex:-1,enableColumnResize:true,enableSorting:true,maintainColumnRatios:undefined,beforeSelectionChange:function(){return true},afterSelectionChange:function(){},columnsChanged:function(){},rowTemplate:undefined,headerRowTemplate:undefined,jqueryUITheme:false,jqueryUIDraggable:false,plugins:[],keepLastSelected:true,groups:[],showGroupPanel:false,enableRowReordering:false,showColumnMenu:true,showFilter:true,disableTextSelection:true,filterOptions:{filterText:ko.observable(""),useExternalFilter:false},enablePaging:false,pagingOptions:{pageSizes:ko.observableArray([250,500,1e3]),pageSize:ko.observable(250),totalServerItems:ko.observable(0),currentPage:ko.observable(1)}},o=this;o.maxCanvasHt=ko.observable(0);o.config=$.extend(s,n);o.config.columnDefs=ko.utils.unwrapObservable(n.columnDefs);o.gridId="ng"+e.kg.utils.newId();o.$root=null;o.$groupPanel=null;o.$topPanel=null;o.$headerContainer=null;o.$headerScroller=null;o.$headers=null;o.$viewport=null;o.$canvas=null;o.rootDim=o.config.gridDim;o.sortInfo=ko.isObservable(o.config.sortInfo)?o.config.sortInfo:ko.observable(o.config.sortInfo);o.sortedData=o.config.data;o.lateBindColumns=false;o.filteredData=ko.observableArray([]);o.lastSortedColumn=undefined;o.showFilter=o.config.showFilter;o.filterText=o.config.filterOptions.filterText;o.disableTextSelection=ko.observable(o.config.disableTextSelection);o.calcMaxCanvasHeight=function(){return o.configGroups().length>0?o.rowFactory.parsedData.filter(function(e){return e[f]===false}).length*o.config.rowHeight:o.filteredData().length*o.config.rowHeight};o.elementDims={scrollW:0,scrollH:0,rowIndexCellW:25,rowSelectedCellW:25,rootMaxW:0,rootMaxH:0};o.setRenderedRows=function(e){o.renderedRows(e);o.refreshDomSizes()};o.minRowsToRender=function(){var e=o.viewportDimHeight()||1;return Math.floor(e/o.config.rowHeight)};o.refreshDomSizes=function(){o.rootDim.outerWidth(o.elementDims.rootMaxW);o.rootDim.outerHeight(o.elementDims.rootMaxH);o.maxCanvasHt(o.calcMaxCanvasHeight())};o.buildColumnDefsFromData=function(){var n=o.sortedData();if(!o.config.columnDefs){o.config.columnDefs=[]}if(!n||!n[0]){o.lateBoundColumns=true;return}var r;r=n[0];e.kg.utils.forIn(r,function(e,n){if(n!=t){o.config.columnDefs.push({field:n})}})};o.buildColumns=function(){var t=o.config.columnDefs,n=[];if(!t){o.buildColumnDefsFromData();t=o.config.columnDefs}if(o.config.displaySelectionCheckbox&&o.config.canSelectRows){t.splice(0,0,{field:"✔",width:o.elementDims.rowSelectedCellW,sortable:false,resizable:false,headerCellTemplate:'<input class="kgSelectionHeader" type="checkbox" data-bind="visible: $grid.multiSelect, checked: $grid.allSelected"/>',cellTemplate:'<div class="kgSelectionCell"><input class="kgSelectionCheckbox" type="checkbox" data-bind="checked: $parent.selected" /></div>'})}if(t.length>0){$.each(t,function(t,r){var i=new e.kg.Column({colDef:r,index:t,headerRowHeight:o.config.headerRowHeight,sortCallback:o.sortData,resizeOnDataCallback:o.resizeOnData,enableResize:o.config.enableColumnResize,enableSort:o.config.enableSorting},o);n.push(i);var s=o.config.groups.indexOf(r.field);if(s!=-1){o.configGroups.splice(s,0,i)}});o.columns(n)}};o.configureColumnWidths=function(){var t=o.config.columnDefs;var n=t.length,r=[],i=[],s=0,u=0;var a=o.columns();$.each(t,function(t,n){var f=false,l=undefined;if(e.kg.utils.isNullOrUndefined(n.width)){n.width="*"}else{f=isNaN(n.width)?e.kg.utils.endsWith(n.width,"%"):false;l=f?n.width:parseInt(n.width,10)}if(isNaN(l)){l=n.width;if(l=="auto"){a[t].width=a[t].minWidth;var c=a[t];$(document).ready(function(){o.resizeOnData(c,true)});return}else if(l.indexOf("*")!=-1){s+=l.length;n.index=t;r.push(n);return}else if(f){n.index=t;i.push(n);return}else{throw'unable to parse column width, use percentage ("10%","20%", etc...) or "*" to use remaining width of grid'}}else{u+=a[t].width=parseInt(n.width,10)}});if(r.length>0){o.config.maintainColumnRatios===false?$.noop():o.config.maintainColumnRatios=true;var f=o.rootDim.outerWidth()-u;var l=Math.floor(f/s);$.each(r,function(t,r){var i=r.width.length;a[r.index].width=l*i;if(r.index+1==n){var s=2;if(o.maxCanvasHt()>o.viewportDimHeight()){s+=e.kg.domUtilityService.ScrollW}a[r.index].width-=s}u+=a[r.index].width})}if(i.length>0){$.each(i,function(e,t){var n=t.width;a[t.index].width=Math.floor(o.rootDim.outerWidth()*(parseInt(n.slice(0,-1),10)/100))})}o.columns(a);e.kg.domUtilityService.BuildStyles(o)};o.init=function(){o.selectionService=new e.kg.SelectionService(o);o.rowFactory=new e.kg.RowFactory(o);o.selectionService.Initialize(o.rowFactory);o.searchProvider=new e.kg.SearchProvider(o);o.styleProvider=new e.kg.StyleProvider(o);o.buildColumns();e.kg.sortService.columns=o.columns;o.configGroups.subscribe(function(e){if(!e){return}var t=[];$.each(e,function(e,n){if(n){t.push(n.field||n)}});o.config.groups=t;o.rowFactory.filteredDataChanged()});o.filteredData.subscribe(function(){if(o.$$selectionPhase){return}o.maxCanvasHt(o.calcMaxCanvasHeight());if(!o.isSorting){o.configureColumnWidths()}});o.maxCanvasHt(o.calcMaxCanvasHeight());o.searchProvider.evalFilter();o.refreshDomSizes()};o.prevScrollTop=0;o.prevScrollIndex=0;o.adjustScrollTop=function(t,n){if(o.prevScrollTop===t&&!n){return}var s=Math.floor(t/o.config.rowHeight);if(o.prevScrollTop<t&&s<o.prevScrollIndex+i){return}if(o.prevScrollTop>t&&s>o.prevScrollIndex-i){return}o.prevScrollTop=t;o.rowFactory.UpdateViewableRange(new e.kg.Range(Math.max(0,s-r),s+o.minRowsToRender()+r));o.prevScrollIndex=s};o.adjustScrollLeft=function(e){if(o.$headerContainer){o.$headerContainer.scrollLeft(e)}};o.resizeOnData=function(t){var n=t.minWidth;var r=e.kg.utils.getElementsByClassName("col"+t.index);$.each(r,function(t,r){var i;if(t===0){var s=$(r).find(".kgHeaderText");i=e.kg.utils.visualLength(s)+10}else{var o=$(r).find(".kgCellText");i=e.kg.utils.visualLength(o)+10}if(i>n){n=i}});t.width=n=Math.min(t.maxWidth,n+7);e.kg.domUtilityService.BuildStyles(o)};o.sortData=function(t,n){o.isSorting=true;o.sortInfo({column:t,direction:n});o.clearSortingData(t);if(!o.config.useExternalSorting){e.kg.sortService.Sort(o.sortInfo.peek(),o.sortedData)}else{o.config.sortInfo(o.sortInfo.peek())}o.lastSortedColumn=t;o.isSorting=false};o.clearSortingData=function(e){if(!e){$.each(o.columns(),function(e,t){t.sortDirection("")})}else if(o.lastSortedColumn&&e!=o.lastSortedColumn){o.lastSortedColumn.sortDirection("")}};o.fixColumnIndexes=function(){o.$$indexPhase=true;var e=o.columns.peek();$.each(e,function(e,t){t.index=e});o.$$indexPhase=false};o.elementsNeedMeasuring=true;o.columns=ko.observableArray([]);o.columns.subscribe(function(e){o.config.columnsChanged(e)});o.renderedRows=ko.observableArray([]);o.headerRow=null;o.rowHeight=o.config.rowHeight;o.jqueryUITheme=ko.observable(o.config.jqueryUITheme);o.footer=null;o.selectedItems=o.config.selectedItems;o.multiSelect=o.config.multiSelect;o.footerVisible=e.kg.utils.isNullOrUndefined(o.config.displayFooter)?o.config.footerVisible:o.config.displayFooter;o.config.footerRowHeight=o.footerVisible?o.config.footerRowHeight:0;o.showColumnMenu=o.config.showColumnMenu;o.showMenu=ko.observable(false);o.configGroups=ko.observableArray([]);o.enablePaging=o.config.enablePaging;o.pagingOptions=o.config.pagingOptions;o.rowTemplate=o.config.rowTemplate||e.kg.defaultRowTemplate();o.headerRowTemplate=o.config.headerRowTemplate||e.kg.defaultHeaderRowTemplate();if(o.config.rowTemplate&&!c.test(o.config.rowTemplate)){o.rowTemplate=e.kg.utils.getTemplatePromise(o.config.rowTemplate)}if(o.config.headerRowTemplate&&!c.test(o.config.headerRowTemplate)){o.headerRowTemplate=e.kg.utils.getTemplatePromise(o.config.headerRowTemplate)}o.visibleColumns=ko.computed(function(){var e=o.columns();return e.filter(function(e){var t=e.visible();return t})});o.nonAggColumns=ko.computed(function(){return o.columns().filter(function(e){return!e.isAggCol})});o.aggColumns=ko.computed(function(){return o.columns().filter(function(e){return e.isAggCol})});o.toggleShowMenu=function(){o.showMenu(!o.showMenu())};o.allSelected=o.config.selectAllState;o.allSelected.subscribe(function(e){if(o.config.beforeSelectionChange(o.sortedData.peek(),this)){o.selectionService.toggleSelectAll(e);o.config.afterSelectionChange(o.selectedItems.peek(),this)}});o.totalFilteredItemsLength=ko.computed(function(){return o.filteredData().length});o.showGroupPanel=ko.computed(function(){return o.config.showGroupPanel});o.topPanelHeight=ko.observable(o.config.showGroupPanel===true?o.config.headerRowHeight*2:o.config.headerRowHeight);o.viewportDimHeight=ko.computed(function(){return Math.max(0,o.rootDim.outerHeight()-o.topPanelHeight()-o.config.footerRowHeight-2)});o.groupBy=function(t){if(o.sortedData().length<1){return}var n=o.configGroups().indexOf(t);if(n==-1){t.isGroupedBy(true);o.configGroups.push(t);t.groupIndex(o.configGroups().length)}else{o.removeGroup(n)}e.kg.domUtilityService.BuildStyles(o)};o.removeGroup=function(t){var n=o.columns().filter(function(e){return e.groupIndex()==t+1})[0];n.isGroupedBy(false);n.groupIndex(0);o.columns.splice(t,1);o.configGroups.splice(t,1);o.fixGroupIndexes();if(o.configGroups().length===0){o.fixColumnIndexes()}e.kg.domUtilityService.BuildStyles(o)};o.fixGroupIndexes=function(){$.each(o.configGroups(),function(e,t){t.groupIndex(e+1)})};o.totalRowWidth=function(){var e=0,t=o.visibleColumns();$.each(t,function(t,n){e+=n.width});return e};o.headerScrollerDim=function(){var t=o.viewportDimHeight(),n=o.maxCanvasHt(),r=n>t,i=new e.kg.Dimension;i.autoFitHeight=true;i.outerWidth=o.totalRowWidth();if(r){i.outerWidth+=o.elementDims.scrollW}else if(n-t<=o.elementDims.scrollH){i.outerWidth+=o.elementDims.scrollW}return i};o.jqueryUITheme=o.config.jqueryUITheme;o.maxRows=ko.observable(Math.max(o.config.pagingOptions.totalServerItems()||o.sortedData().length,1));o.maxRowsDisplay=ko.computed(function(){return o.maxRows()});o.multiSelect=ko.observable(o.config.canSelectRows&&o.config.multiSelect);o.selectedItemCount=ko.computed(function(){return o.selectedItems().length});o.maxPages=ko.computed(function(){o.maxRows(Math.max(o.config.pagingOptions.totalServerItems()||o.sortedData().length,1));return Math.ceil(o.maxRows()/o.pagingOptions.pageSize())});o.pageForward=function(){var e=o.config.pagingOptions.currentPage();o.config.pagingOptions.currentPage(Math.min(e+1,o.maxPages()))};o.pageBackward=function(){var e=o.config.pagingOptions.currentPage();o.config.pagingOptions.currentPage(Math.max(e-1,1))};o.pageToFirst=function(){o.config.pagingOptions.currentPage(1)};o.pageToLast=function(){var e=o.maxPages();o.config.pagingOptions.currentPage(e)};o.cantPageForward=ko.computed(function(){var e=o.config.pagingOptions.currentPage();var t=o.maxPages();return!(e<t)});o.cantPageBackward=ko.computed(function(){var e=o.config.pagingOptions.currentPage();return!(e>1)});o.init()};kg.Range=function(e,t){this.topRow=e;this.bottomRow=t};e.kg.Row=function(n,r,i){var s=this;s.canSelectRows=r.canSelectRows;s.rowClasses=r.rowClasses;s.selectedItems=r.selectedItems;s.entity=n;s.selectionService=i;s.selected=ko.observable(false);s.continueSelection=function(e){s.selectionService.ChangeSelection(s,e)};s.toggleSelected=function(e,t){if(!s.canSelectRows){return true}var n=t.target||t;if(n.type=="checkbox"){s.selected(!s.selected())}if(r.selectWithCheckboxOnly&&n.type!="checkbox"){return true}else{if(s.beforeSelectionChange(s,t)){s.continueSelection(t);return s.afterSelectionChange(s,t)}}return false};if(s.entity[t]===undefined){s.entity[t]=false}else{s.selectionService.setSelection(s,s.entity[t])}s.rowIndex=ko.observable(0);s.offsetTop=ko.observable("0px");s.rowDisplayIndex=0;s.isEven=ko.computed(function(){if(s.rowIndex()%2===0){return true}return false});s.isOdd=ko.computed(function(){if(s.rowIndex()%2!==0){return true}return false});s.beforeSelectionChange=r.beforeSelectionChangeCallback;s.afterSelectionChange=r.afterSelectionChangeCallback;s.propertyCache={};s.getProperty=function(t){return s.propertyCache[t]||(s.propertyCache[t]=e.kg.utils.evalProperty(s.entity,t))}};e.kg.SearchProvider=function(e){var t=this,n=[],r;t.extFilter=e.config.filterOptions.useExternalFilter;t.showFilter=e.config.showFilter;t.filterText=e.config.filterOptions.filterText;t.throttle=e.config.filterOptions.filterThrottle;t.fieldMap={};t.evalFilter=function(){if(n.length===0){e.filteredData(e.sortedData.peek().filter(function(e){return!e._destroy}))}else{e.filteredData(e.sortedData.peek().filter(function(e){if(e._destroy){return false}for(var r=0,i=n.length;r<i;r++){var s=n[r];if(!s.column){for(var o in e){if(e.hasOwnProperty(o)){var u=ko.utils.unwrapObservable(e[o]);if(u&&s.regex.test(u.toString())){return true}}}return false}var a=ko.utils.unwrapObservable(e[s.column])||ko.utils.unwrapObservable(e[t.fieldMap[s.columnDisplay]]);if(!a||!s.regex.test(a.toString())){return false}}return true}))}e.rowFactory.filteredDataChanged()};var i=function(e,t){try{return new RegExp(e,t)}catch(n){return new RegExp(e.replace(/(\^|\$|\(|\)|\<|\>|\[|\]|\{|\}|\\|\||\.|\*|\+|\?)/g,"\\$1"))}};var s=function(e){n=[];var t;if(!(t=$.trim(e))){return}var r=t.split(";");$.each(r,function(e,t){var r=t.split(":");if(r.length>1){var s=$.trim(r[0]);var o=$.trim(r[1]);if(s&&o){n.push({column:s,columnDisplay:s.replace(/\s+/g,"").toLowerCase(),regex:i(o,"i")})}}else{var u=$.trim(r[0]);if(u){n.push({column:"",regex:i(u,"i")})}}})};var o=ko.computed(function(){var e=t.filterText();if(!t.extFilter&&e!=r){r=e;s(e);t.evalFilter()}});if(typeof t.throttle==="number"){o.extend({throttle:t.throttle})}if(!t.extFilter){e.columns.subscribe(function(e){$.each(e,function(e,n){t.fieldMap[n.displayName().toLowerCase().replace(/\s+/g,"")]=n.field})})}};e.kg.SelectionService=function(e){var n=this;n.multi=e.config.multiSelect;n.selectedItems=e.config.selectedItems;n.selectedIndex=e.config.selectedIndex;n.lastClickedRow=undefined;n.ignoreSelectedItemChanges=false;n.rowFactory={};n.Initialize=function(e){n.rowFactory=e};n.ChangeSelection=function(r,i){e.$$selectionPhase=true;if(i&&i.shiftKey&&n.multi){if(n.lastClickedRow){var s=e.filteredData.indexOf(r.entity);var o=e.filteredData.indexOf(n.lastClickedRow.entity);if(e.aggColumns().length>0){s=e.rowFactory.rowCache.indexOf(r);o=e.rowFactory.rowCache.indexOf(n.lastClickedRow)}if(s==o){return false}o++;if(s<o){s=s^o;o=s^o;s=s^o}var u=[];for(;o<=s;o++){u.push(n.rowFactory.rowCache[o])}if(u[u.length-1].beforeSelectionChange(u,i)){$.each(u,function(e,r){r.selected(true);r.entity[t]=true;if(n.selectedItems.indexOf(r.entity)===-1){n.selectedItems.push(r.entity)}});u[u.length-1].afterSelectionChange(u,i)}n.lastClickedRow=u[u.length-1];e.$$selectionPhase=false;return true}}else if(!n.multi){if(n.lastClickedRow&&n.lastClickedRow!=r){n.setSelection(n.lastClickedRow,false)}n.setSelection(r,e.config.keepLastSelected?true:!r.selected())}else{n.setSelection(r,!r.selected())}n.lastClickedRow=r;e.$$selectionPhase=false;return true};n.setSelection=function(e,r){e.selected(r);e.entity[t]=r;if(!r){var i=n.selectedItems.indexOf(e.entity);n.selectedItems.splice(i,1)}else{if(n.selectedItems.indexOf(e.entity)===-1){n.selectedItems.push(e.entity)}}};n.toggleSelectAll=function(r){var i=n.selectedItems().length;if(i>0){n.selectedItems.splice(0,i)}$.each(e.filteredData(),function(e,i){i[t]=r;if(r){n.selectedItems.push(i)}});$.each(n.rowFactory.rowCache,function(e,t){if(t&&t.selected){t.selected(r)}})}};e.kg.StyleProvider=function(t){t.canvasStyle=ko.computed(function(){return{height:t.maxCanvasHt().toString()+"px"}});t.headerScrollerStyle=ko.computed(function(){return{height:t.config.headerRowHeight+"px"}});t.topPanelStyle=ko.computed(function(){return{width:t.rootDim.outerWidth()+"px",height:t.topPanelHeight()+"px"}});t.headerStyle=ko.computed(function(){return{width:Math.max(0,t.rootDim.outerWidth()-e.kg.domUtilityService.ScrollW)+"px",height:t.config.headerRowHeight+"px"}});t.viewportStyle=ko.computed(function(){return{width:t.rootDim.outerWidth()+"px",height:t.viewportDimHeight()+"px"}});t.footerStyle=ko.computed(function(){return{width:t.rootDim.outerWidth()+"px",height:t.config.footerRowHeight+"px"}})};e.kg.sortService={colSortFnCache:{},dateRE:/^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)$/,guessSortFn:function(t){var n,r,i,s,o;if(t===undefined||t===null||t===""){return null}r=typeof t;switch(r){case"number":n=e.kg.sortService.sortNumber;break;case"boolean":n=e.kg.sortService.sortBool;break;default:n=undefined;break}if(n){return n}if(Object.prototype.toString.call(t)==="[object Date]"){return e.kg.sortService.sortDate}if(r!=="string"){return e.kg.sortService.basicSort}if(t.match(/^-?[£$¤]?[\d,.]+%?$/)){return e.kg.sortService.sortNumberStr}i=t.match(e.kg.sortService.dateRE);if(i){s=parseInt(i[1],10);o=parseInt(i[2],10);if(s>12){return e.kg.sortService.sortDDMMStr}else if(o>12){return e.kg.sortService.sortMMDDStr}else{return e.kg.sortService.sortMMDDStr}}return e.kg.sortService.sortAlpha},basicSort:function(e,t){if(e==t){return 0}if(e<t){return-1}return 1},sortNumber:function(e,t){return e-t},sortNumberStr:function(e,t){var n,r,i=false,s=false;n=parseFloat(e.replace(/[^0-9.-]/g,""));if(isNaN(n)){i=true}r=parseFloat(t.replace(/[^0-9.-]/g,""));if(isNaN(r)){s=true}if(i&&s){return 0}if(i){return 1}if(s){return-1}return n-r},sortAlpha:function(e,t){var n=e.toLowerCase(),r=t.toLowerCase();return n==r?0:n<r?-1:1},sortBool:function(e,t){if(e&&t){return 0}if(!e&&!t){return 0}else{return e?1:-1}},sortDate:function(e,t){var n=e.getTime(),r=t.getTime();return n==r?0:n<r?-1:1},sortDDMMStr:function(t,n){var r,i,s,o,u,a;s=t.match(e.kg.sortService.dateRE);a=s[3];o=s[2];u=s[1];if(o.length==1){o="0"+o}if(u.length==1){u="0"+u}r=a+o+u;s=n.match(e.kg.sortService.dateRE);a=s[3];o=s[2];u=s[1];if(o.length==1){o="0"+o}if(u.length==1){u="0"+u}i=a+o+u;if(r==i){return 0}if(r<i){return-1}return 1},sortMMDDStr:function(t,n){var r,i,s,o,u,a;s=t.match(e.kg.sortService.dateRE);a=s[3];u=s[2];o=s[1];if(o.length==1){o="0"+o}if(u.length==1){u="0"+u}r=a+o+u;s=n.match(dateRE);a=s[3];u=s[2];o=s[1];if(o.length==1){o="0"+o}if(u.length==1){u="0"+u}i=a+o+u;if(r==i){return 0}if(r<i){return-1}return 1},sortData:function(t,n){var r=t();if(!r||!n){return}var i=n.column,o=n.direction,u,a;if(e.kg.sortService.colSortFnCache[i.field]){u=e.kg.sortService.colSortFnCache[i.field]}else if(i.sortingAlgorithm!=undefined){u=i.sortingAlgorithm;e.kg.sortService.colSortFnCache[i.field]=i.sortingAlgorithm}else{a=r[0];if(!a){return}u=kg.sortService.guessSortFn(a[i.field]);if(u){e.kg.sortService.colSortFnCache[i.field]=u}else{u=e.kg.sortService.sortAlpha}}r.sort(function(t,n){var r=e.kg.utils.evalProperty(t,i.field);var a=e.kg.utils.evalProperty(n,i.field);if(!a&&!r){return 0}else if(!r){return 1}else if(!a){return-1}if(o===s){return u(r,a)}else{return 0-u(r,a)}});t(r);return},Sort:function(t,n){if(e.kg.sortService.isSorting){return}e.kg.sortService.isSorting=true;e.kg.sortService.sortData(n,t);e.kg.sortService.isSorting=false}};var h=function(){var t=$("<div></div>");t.appendTo("body");t.height(100).width(100).css("position","absolute").css("overflow","scroll");t.append('<div style="height: 400px; width: 400px;"></div>');e.kg.domUtilityService.ScrollH=t.height()-t[0].clientHeight;e.kg.domUtilityService.ScrollW=t.width()-t[0].clientWidth;t.empty();t.attr("style","");t.append('<span style="font-family: Verdana, Helvetica, Sans-Serif; font-size: 14px;"><strong>M</strong></span>');e.kg.domUtilityService.LetterW=t.children().first().width();t.remove()};e.kg.domUtilityService={AssignGridContainers:function(t,n){n.$root=$(t);n.$topPanel=n.$root.find(".kgTopPanel");n.$groupPanel=n.$root.find(".kgGroupPanel");n.$headerContainer=n.$topPanel.find(".kgHeaderContainer");n.$headerScroller=n.$topPanel.find(".kgHeaderScroller");n.$headers=n.$headerScroller.children();n.$viewport=n.$root.find(".kgViewport");n.$canvas=n.$viewport.find(".kgCanvas");n.$footerPanel=n.$root.find(".ngFooterPanel");e.kg.domUtilityService.UpdateGridLayout(n)},UpdateGridLayout:function(e){var t=e.$viewport.scrollTop();e.elementDims.rootMaxW=e.$root.width();e.elementDims.rootMaxH=e.$root.height();e.refreshDomSizes();e.adjustScrollTop(t,true)},BuildStyles:function(t){var n=t.config.rowHeight,r=t.$styleSheet,i=t.gridId,s,o=t.visibleColumns(),u=0;if(!r){r=$("#"+i);if(!r[0]){r=$("<style id='"+i+"' type='text/css' rel='stylesheet' />");r.appendTo("body")}}r.empty();var a=t.totalRowWidth();s="."+i+" .kgCanvas { width: "+a+"px; }"+"."+i+" .kgRow { width: "+a+"px; }"+"."+i+" .kgCell { height: "+n+"px; }"+"."+i+" .kgCanvas { width: "+a+"px; }"+"."+i+" .kgHeaderCell { top: 0; bottom: 0; }"+"."+i+" .kgHeaderScroller { width: "+(a+e.kg.domUtilityService.scrollH+2)+"px}";$.each(o,function(e,t){s+="."+i+" .col"+e+" { width: "+t.width+"px; left: "+u+"px; right: "+(a-u-t.width)+"px; height: "+n+"px }"+"."+i+" .colt"+e+" { width: "+t.width+"px; }";u+=t.width});if(e.kg.utils.isIe){r[0].styleSheet.cssText=s}else{r.append(document.createTextNode(s))}t.$styleSheet=r},ScrollH:17,ScrollW:17,LetterW:10};h()})(window)
