/***********************************************
* koGrid JavaScript Library
* Authors: https://github.com/ericmbarnard/koGrid/blob/master/README.md
* License: MIT (http://www.opensource.org/licenses/mit-license.php)
* Compiled At: 07/29/2013 15:29:44
***********************************************/
(function(i){if(!i.kg){i.kg={}}i.kg.numberOfGrids=0;i.kg.eventStorage={};var b="__kg_selected__",k="__koGrid__",m=8,a=6,e="asc",f="desc",j="_kg_field_",d="_kg_depth_",g="_kg_hidden_",c="_kg_column_",h=/<.+>/;i.kg.moveSelectionHandler=function(r,o){if(i.kg.utils.isNullOrUndefined(r)||i.kg.utils.isNullOrUndefined(r.config.selectedItems)){return true}var n=o.which||o.keyCode,s=(n===38?-1:(n===40?1:null));if(!s){return true}var p=r.renderedRows(),q=p.indexOf(r.selectionService.lastClickedRow)+s;if(q<0||q>=p.length){return true}r.selectionService.ChangeSelection(p[q],o);if(q>p.length-m){r.$viewport.scrollTop(r.$viewport.scrollTop()+(r.config.rowHeight*m))}else{if(q<m){r.$viewport.scrollTop(r.$viewport.scrollTop()-(r.config.rowHeight*m))}}return false};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(o){var n=this.length>>>0;var p=Number(arguments[1])||0;p=(p<0)?Math.ceil(p):Math.floor(p);if(p<0){p+=n}for(;p<n;p++){if(p in this&&this[p]===o){return p}}return -1}}if(!Array.prototype.filter){Array.prototype.filter=function(o){var s=Object(this),n=s.length>>>0;if(typeof o!=="function"){throw new TypeError()}var r=[];var q=arguments[1];for(var p=0;p<n;p++){if(p in s){var u=s[p];if(o.call(q,u,p,s)){r.push(u)}}}return r}}i.kg.utils={visualLength:function(o){var n=document.getElementById("testDataLength");if(!n){n=document.createElement("SPAN");n.id="testDataLength";n.style.visibility="hidden";document.body.appendChild(n)}$(n).css("font",$(o).css("font"));n.innerHTML=$(o).text();return n.offsetWidth},forIn:function(o,n){for(var p in o){if(o.hasOwnProperty(p)){n(o[p],p)}}},evalProperty:function(q,t){var s=ko.utils.unwrapObservable(q);var o=t.split("."),r=0;var n=ko.utils.unwrapObservable(s[o[r]]),p=o.length;r++;while(n&&r<p){n=ko.utils.unwrapObservable(n[o[r]]);r++}return n},endsWith:function(o,n){if(!o||!n||typeof o!="string"){return false}return o.indexOf(n,o.length-n.length)!==-1},isNullOrUndefined:function(n){if(n===undefined||n===null){return true}return false},getElementsByClassName:function(o){var n=[];var s=new RegExp("\\b"+o+"\\b");var r=document.getElementsByTagName("*");for(var q=0;q<r.length;q++){var p=r[q].className;if(s.test(p)){n.push(r[q])}}return n},getTemplatePromise:function(n){return $.ajax(n)},newId:(function(){var n=new Date().getTime();return function(){return n+=1}})(),ieVersion:(function(){var n=3,p=document.createElement("div"),o=p.getElementsByTagName("i");while(p.innerHTML="<!--[if gt IE "+(++n)+"]><i></i><![endif]-->",o[0]){}return n>4?n:undefined})()};$.extend(i.kg.utils,{isIe6:(function(){return i.kg.utils.ieVersion===6})(),isIe7:(function(){return i.kg.utils.ieVersion===7})(),isIe:(function(){return i.kg.utils.ieVersion!==undefined})()});i.kg.defaultGridTemplate=function(){return'<div data-bind="css: {\'ui-widget\': jqueryUITheme, \'kgNoSelect\' : disableTextSelection}"><div class="kgTopPanel" data-bind="css: {\'ui-widget-header\':jqueryUITheme, \'ui-corner-top\': jqueryUITheme}, style: $data.topPanelStyle"><div class="kgGroupPanel" data-bind="visible: $data.showGroupPanel, style: headerStyle"><div class="kgGroupPanelDescription" data-bind="visible: configGroups().length == 0">Drag a column header here and drop it to group by that column</div><ul data-bind="visible: configGroups().length > 0, foreach: configGroups" class="kgGroupList"><li class="kgGroupItem"><span class="kgGroupElement"><div class="kgGroupName"><span data-bind="text: displayName"></span><span data-bind="click: function(data) { $root.removeGroup($index()) }" class="kgRemoveGroup">x</span></div><span data-bind="visible: $index() < ($root.configGroups().length - 1)" class="kgGroupArrow"></span></span></li></ul></div><div class="kgHeaderContainer" data-bind="style: headerStyle"><div class="kgHeaderScroller" data-bind="style: headerScrollerStyle, kgHeaderRow: $data" ></div></div><div class="kgHeaderButton" data-bind="visible: ($data.showColumnMenu || $data.showFilter), click: toggleShowMenu"><div class="kgHeaderButtonArrow"></div></div><div data-bind="visible: showMenu" class="kgColMenu"><div data-bind="visible: showFilter"><input placeholder="Seach Field:Value" type="text" data-bind="value: filterText, valueUpdate: \'afterkeydown\'"/></div><div data-bind="visible: showColumnMenu"><span class="kgMenuText">Choose Columns:</span><ul class="kgColList" data-bind="foreach: groupableByCol"><li class="kgColListItem"><label style="position: relative;"><input type="checkbox" class="kgColListCheckbox" data-bind="checked: visible"/><span data-bind="text: displayName, click: toggleVisible"></span><a title="Group By" data-bind="attr: {\'class\': groupedByClass }, visible: (field != \'\u2714\'), click: $parent.groupBy"></a><span class="kgGroupingNumber" data-bind="visible: groupIndex() > 0, text: groupIndex"></span></label></li></ul></div></div></div><div class="kgViewport" data-bind="css: {\'ui-widget-content\': jqueryUITheme}, style: viewportStyle"><div class="kgCanvas" data-bind="style: canvasStyle"><div data-bind="foreach: renderedRows" style="position: absolute;"><div data-bind="style: { \'top\': offsetTop, \'height\': $parent.rowHeight + \'px\' }, click: toggleSelected, css: {\'selected\': selected, \'even\': isEven , \'odd\': isOdd, \'ui-state-default\': $parent.jqueryUITheme && isOdd, \'ui-state-active\':$parent.jqueryUITheme && isEven}, kgRow: $data" class="kgRow"></div></div></div></div><div class="kgFooterPanel" data-bind="css: {\'ui-widget-content\': jqueryUITheme, \'ui-corner-bottom\': jqueryUITheme}, style: footerStyle"><div class="kgTotalSelectContainer" data-bind="visible: footerVisible"><div class="kgFooterTotalItems" data-bind="css: {\'kgNoMultiSelect\': !multiSelect}" ><span class="kgLabel">Total Items: <span data-bind="text: maxRowsDisplay"></span></span><span data-bind="visible: filterText().length > 0" class="kgLabel">(Showing: <span data-bind="text: totalFilteredItemsLength"></span>)</span></div><div class="kgFooterSelectedItems" data-bind="visible: multiSelect"><span class="kgLabel">Selected Items: <span data-bind="text: selectedItemCount"></span></span></div></div><div class="kgPagerContainer" style="float: right; margin-top: 10px;" data-bind="visible: (footerVisible && enablePaging), css: {\'kgNoMultiSelect\': !multiSelect}"><div style="float:left; margin-right: 10px;" class="kgRowCountPicker"><span style="float: left; margin-top: 3px;" class="kgLabel">Page Size:</span><select style="float: left;height: 27px; width: 100px" data-bind="value: pagingOptions.pageSize, options: pagingOptions.pageSizes"></select></div><div style="float:left; margin-right: 10px; line-height:25px;" class="kgPagerControl" style="float: left; min-width: 135px;"><button class="kgPagerButton" data-bind="click: pageToFirst, disable: cantPageBackward()" title="First Page"><div class="kgPagerFirstTriangle"><div class="kgPagerFirstBar"></div></div></button><button class="kgPagerButton" data-bind="click: pageBackward, disable: cantPageBackward()" title="Previous Page"><div class="kgPagerFirstTriangle kgPagerPrevTriangle"></div></button><input class="kgPagerCurrent" type="number" style="width:50px; height: 24px; margin-top: 1px; padding: 0px 4px;" data-bind="value: pagingOptions.currentPage, valueUpdate: \'afterkeydown\'"/><button class="kgPagerButton" data-bind="click: pageForward, disable: cantPageForward()" title="Next Page"><div class="kgPagerLastTriangle kgPagerNextTriangle"></div></button><button class="kgPagerButton" data-bind="click: pageToLast, disable: cantPageForward()" title="Last Page"><div class="kgPagerLastTriangle"><div class="kgPagerLastBar"></div></div></button></div></div></div></div>'};i.kg.defaultRowTemplate=function(){return"<div data-bind=\"style: { cursor : canSelectRows ? 'pointer' : 'default' }, foreach: $grid.visibleColumns, css: { 'ui-widget-content': $grid.jqueryUITheme }\"><div data-bind=\"attr: { 'class': cellClass() + ' kgCell col' + $index() }, kgCell: $data\"></div></div>"};i.kg.defaultCellTemplate=function(){return"<div data-bind=\"attr: { 'class': 'kgCellText colt' + $index()}, html: $data.getProperty($parent)\"></div>"};i.kg.aggregateTemplate=function(){return'<div data-bind="click: toggleExpand, style: {\'left\': offsetLeft()}" class="kgAggregate"><span class="kgAggregateText" data-bind="html: $data.label">(<span data-bind="html: totalChildren"></span> Items)</span><div data-bind="attr: {\'class\' : aggClass }"></div></div>'};i.kg.defaultHeaderRowTemplate=function(){return"<div data-bind=\"foreach: visibleColumns\"><div data-bind=\"kgHeaderCell: $data, attr: { 'class': 'kgHeaderCell col' + $index() }\"></div></div>"};i.kg.defaultHeaderCellTemplate=function(){return"<div data-bind=\"style: { cursor : sortable() ? 'pointer' : 'default' }, click: sort, css: {'kgSorted': !noSortVisible }, attr: {'class': 'kgHeaderSortColumn ' + headerClass()}\"><div data-bind=\"attr: { 'class': 'colt' + $index() + ' kgHeaderText' }, html: displayName\"></div><div class=\"kgSortButtonDown\" data-bind=\"visible: showSortButtonDown\"></div><div class=\"kgSortButtonUp\" data-bind=\"visible: showSortButtonUp\"></div><div data-bind=\"visible: resizable, click: gripClick, mouseEvents: { mouseDown: gripOnMouseDown }\" class=\"kgHeaderGrip\" ></div></div>"};ko.bindingHandlers.koGrid=(function(){return{init:function(q,t,p,u,r){var v=t();var o=$(q);v.gridDim=new i.kg.Dimension({outerHeight:ko.observable(o.height()),outerWidth:ko.observable(o.width())});var n=new i.kg.Grid(v);var s=$(i.kg.defaultGridTemplate());v.data.subscribe(function(){if(n.$$selectionPhase){return}n.searchProvider.evalFilter();n.refreshDomSizes()});if(ko.isObservable(v.columnDefs)){v.columnDefs.subscribe(function(w){n.columns([]);n.config.columnDefs=w;n.buildColumns();n.configureColumnWidths()})}o.addClass("koGrid").addClass(n.gridId.toString());o.append(s);n.$userViewModel=r.$data;ko.applyBindings(n,s[0]);i.kg.domUtilityService.AssignGridContainers(o,n);n.configureColumnWidths();n.refreshDomSizes();n.eventProvider=new i.kg.EventProvider(n);$.each(n.config.plugins,function(w,x){if(typeof x.onGridInit==="function"){x.onGridInit(n)}});i.kg.domUtilityService.BuildStyles(n);return{controlsDescendantBindings:true}}}}());ko.bindingHandlers.kgRow=(function(){return{init:function(q,s,p,t,r){var v=s();var o=v.$grid=r.$parent;var n;if(v.isAggRow){n=i.kg.aggregateTemplate()}else{n=o.rowTemplate}var u=function(w){var x=$(w);v.$userViewModel=r.$parent.$userViewModel;ko.applyBindings(v,x[0]);$(q).html(x)};if(n.then){n.then(function(w){u(w)})}else{u(n)}return{controlsDescendantBindings:true}}}}());ko.bindingHandlers.kgCell=(function(){return{init:function(p,q,s,o,n){n.$userViewModel=n.$parent.$userViewModel;var r=function(u){var t=$(u);ko.applyBindings(n,t[0]);$(p).html(t)};if(o.cellTemplate.then){o.cellTemplate.then(function(t){r(t)})}else{r(o.cellTemplate)}return{controlsDescendantBindings:true}}}}());ko.bindingHandlers.kgHeaderRow=(function(){return{init:function(p,q,s,o,n){n.$userViewModel=n.$data.$userViewModel;var r=function(t){var u=$(t);ko.applyBindings(n,u[0]);$(p).html(u)};if(o.headerRowTemplate.then){o.headerRowTemplate.then(function(t){r(t)})}else{r(o.headerRowTemplate)}return{controlsDescendantBindings:true}}}}());ko.bindingHandlers.kgHeaderCell=(function(){return{init:function(p,q,s,o,n){var t=n.extend({$grid:n.$parent,$userViewModel:n.$parent.$userViewModel});var r=function(u){var v=$(u);ko.applyBindings(t,v[0]);$(p).html(v)};if(o.headerCellTemplate.then){o.headerCellTemplate.then(function(u){r(u)})}else{r(o.headerCellTemplate)}return{controlsDescendantBindings:true}}}}());ko.bindingHandlers.mouseEvents=(function(){return{init:function(p,q,s,o,n){var r=q();if(r.mouseDown){$(p).mousedown(r.mouseDown)}}}}());i.kg.Aggregate=function(p,o){var n=this;n.index=0;n.offsetTop=ko.observable(0);n.entity=p;n.label=ko.observable(p.gLabel);n.field=p.gField;n.depth=p.gDepth;n.parent=p.parent;n.children=p.children;n.aggChildren=p.aggChildren;n.aggIndex=p.aggIndex;n.collapsed=ko.observable(true);n.isAggRow=true;n.offsetLeft=ko.observable((p.gDepth*25).toString()+"px");n.aggLabelFilter=p.aggLabelFilter;n.toggleExpand=function(){var q=n.collapsed();n.collapsed(!q);n.notifyChildren()};n.setExpand=function(q){n.collapsed(q);n.notifyChildren()};n.notifyChildren=function(){$.each(n.aggChildren,function(r,t){t.entity[g]=n.collapsed();if(n.collapsed()){var s=n.collapsed();t.setExpand(s)}});$.each(n.children,function(r,s){s[g]=n.collapsed()});o.rowCache=[];var q=false;$.each(o.aggCache,function(s,r){if(q){var t=(30*n.children.length);var u=n.collapsed();r.offsetTop(u?r.offsetTop()-t:r.offsetTop()+t)}else{if(s==n.aggIndex){q=true}}});o.renderedChange()};n.aggClass=ko.computed(function(){return n.collapsed()?"kgAggArrowCollapsed":"kgAggArrowExpanded"});n.totalChildren=ko.computed(function(){if(n.aggChildren.length>0){var q=0;var r=function(s){if(s.aggChildren.length>0){$.each(s.aggChildren,function(t,u){r(u)})}else{q+=s.children.length}};r(n);return q}else{return n.children.length}});n.selected=ko.observable(false);n.isEven=ko.observable(false);n.isOdd=ko.observable(false);n.toggleSelected=function(){return true}};i.kg.Column=function(p,r){var n=this,s=p.colDef,o=500,q=0,t=null;n.eventTaget=undefined;n.width=s.width;n.groupIndex=ko.observable(0);n.isGroupedBy=ko.observable(false);n.groupedByClass=ko.computed(function(){return n.isGroupedBy()?"kgGroupedByIcon":"kgGroupIcon"});n.sortable=ko.observable(false);n.resizable=ko.observable(false);n.minWidth=!s.minWidth?50:s.minWidth;n.maxWidth=!s.maxWidth?9000:s.maxWidth;n.headerRowHeight=p.headerRowHeight;n.displayName=ko.observable(s.displayName||s.field);n.index=p.index;n.isAggCol=p.isAggCol;n.isGroupable=s.isGroupable;n.cellClass=ko.observable(s.cellClass||"");n.cellFilter=s.cellFilter||s.cellFormatter;n.field=s.field;n.aggLabelFilter=s.cellFilter||s.cellFormatter||s.aggLabelFilter||s.aggLabelFormatter;n._visible=ko.observable(i.kg.utils.isNullOrUndefined(s.visible)||s.visible);n.visible=ko.computed({read:function(){return n._visible()},write:function(u){n.toggleVisible(u)}});if(p.enableSort){n.sortable(i.kg.utils.isNullOrUndefined(s.sortable)||s.sortable)}if(p.enableResize){n.resizable(i.kg.utils.isNullOrUndefined(s.resizable)||s.resizable)}n.sortDirection=ko.observable(undefined);n.sortingAlgorithm=s.sortFn;n.headerClass=ko.observable(s.headerClass);n.headerCellTemplate=s.headerCellTemplate||i.kg.defaultHeaderCellTemplate();n.cellTemplate=s.cellTemplate||i.kg.defaultCellTemplate();if(s.cellTemplate&&!h.test(s.cellTemplate)){n.cellTemplate=i.kg.utils.getTemplatePromise(s.cellTemplate)}if(s.headerCellTemplate&&!h.test(s.headerCellTemplate)){n.headerCellTemplate=i.kg.utils.getTemplatePromise(s.headerCellTemplate)}n.getProperty=function(v){var u;if(n.cellFilter){u=n.cellFilter(v.getProperty(n.field))}else{u=v.getProperty(n.field)}return u};n.toggleVisible=function(w){var u;if(i.kg.utils.isNullOrUndefined(w)||typeof w=="object"){u=!n._visible()}else{u=w}n._visible(u);i.kg.domUtilityService.BuildStyles(r)};n.showSortButtonUp=ko.computed(function(){return n.sortable?n.sortDirection()===f:n.sortable});n.showSortButtonDown=ko.computed(function(){return n.sortable?n.sortDirection()===e:n.sortable});n.noSortVisible=ko.computed(function(){return !n.sortDirection()});n.sort=function(){if(!n.sortable()){return true}var u=n.sortDirection()===e?f:e;n.sortDirection(u);p.sortCallback(n,u);return false};n.gripClick=function(v,u){u.stopPropagation();q++;if(q===1){t=setTimeout(function(){q=0},o)}else{clearTimeout(t);p.resizeOnDataCallback(n);q=0}};n.gripOnMouseDown=function(u){u.stopPropagation();if(u.ctrlKey){n.toggleVisible();i.kg.domUtilityService.BuildStyles(r);r.config.columnsChanged(r.columns.peek());return true}n.eventTaget=u.target.parentElement;n.eventTaget.style.cursor="col-resize";n.startMousePosition=u.clientX;n.origWidth=n.width;$(document).mousemove(n.onMouseMove);$(document).mouseup(n.gripOnMouseUp);return false};n.onMouseMove=function(v){v.stopPropagation();var w=v.clientX-n.startMousePosition;var u=w+n.origWidth;n.width=(u<n.minWidth?n.minWidth:(u>n.maxWidth?n.maxWidth:u));i.kg.domUtilityService.BuildStyles(r);return false};n.gripOnMouseUp=function(u){u.stopPropagation();$(document).off("mousemove");$(document).off("mouseup");n.eventTaget.style.cursor=n.sortable()?"pointer":"default";n.eventTaget=undefined;r.config.columnsChanged(r.columns.peek());return false}};i.kg.Dimension=function(n){this.outerHeight=null;this.outerWidth=null;$.extend(this,n)};i.kg.EventProvider=function(o){var n=this;n.colToMove=undefined;n.groupToMove=undefined;n.assignEvents=function(){if(o.config.jqueryUIDraggable){o.$groupPanel.droppable({addClasses:false,drop:function(p){n.onGroupDrop(p)}});$(document).ready(n.setDraggables)}else{o.$groupPanel.on("mousedown",n.onGroupMouseDown).on("dragover",n.dragOver).on("drop",n.onGroupDrop);o.$headerScroller.on("mousedown",n.onHeaderMouseDown).on("dragover",n.dragOver).on("drop",n.onHeaderDrop);if(o.config.enableRowReordering){o.$viewport.on("mousedown",n.onRowMouseDown).on("dragover",n.dragOver).on("drop",n.onRowDrop)}n.setDraggables()}o.columns.subscribe(n.setDraggables)};n.dragOver=function(p){p.preventDefault()};n.setDraggables=function(){if(!o.config.jqueryUIDraggable){o.$root.find(".kgHeaderSortColumn").attr("draggable","true");if(navigator.userAgent.indexOf("MSIE")!=-1){o.$root.find(".kgHeaderSortColumn").bind("selectstart",function(){this.dragDrop();return false})}}else{o.$root.find(".kgHeaderSortColumn").draggable({helper:"clone",appendTo:"body",stack:"div",addClasses:false,start:function(p){n.onHeaderMouseDown(p)}}).droppable({drop:function(p){n.onHeaderDrop(p)}})}};n.onGroupMouseDown=function(r){var p=$(r.target);if(p[0].className!="kgRemoveGroup"){var q=ko.dataFor(p[0]);if(q){if(!o.config.jqueryUIDraggable){p.attr("draggable","true")}n.groupToMove={header:p,groupName:q,index:q.groupIndex()-1}}}else{n.groupToMove=undefined}};n.onGroupDrop=function(p){var q;var r;if(n.groupToMove){q=$(p.target).closest(".kgGroupElement");if(q.context.className=="kgGroupPanel"){o.configGroups.splice(n.groupToMove.index,1);o.configGroups.push(n.groupToMove.groupName)}else{r=ko.dataFor(q[0]);if(r){if(n.groupToMove.index!=r.groupIndex()){o.configGroups.splice(n.groupToMove.index,1);o.configGroups.splice(r.groupIndex(),0,n.groupToMove.groupName)}}}n.groupToMove=undefined;o.fixGroupIndexes()}else{if(o.configGroups.indexOf(n.colToMove.col)==-1){q=$(p.target).closest(".kgGroupElement");if(q.context.className=="kgGroupPanel"||q.context.className=="kgGroupPanelDescription"){o.groupBy(n.colToMove.col)}else{r=ko.dataFor(q[0]);if(r){o.removeGroup(r.groupIndex())}}}n.colToMove=undefined}};n.onHeaderMouseDown=function(r){var q=$(r.target).closest(".kgHeaderSortColumn");if(!q[0]){return true}var p=ko.dataFor(q[0]);if(p){n.colToMove={header:q,col:p}}return true};n.onHeaderDrop=function(r){if(!n.colToMove){return true}var q=$(r.target).closest(".kgHeaderSortColumn");if(!q[0]){return true}var p=ko.dataFor(q[0]);if(p){if(n.colToMove.col==p){return true}var s=o.columns.peek();s.splice(n.colToMove.col.index,1);s.splice(p.index,0,n.colToMove.col);o.fixColumnIndexes();o.columns(s);i.kg.domUtilityService.BuildStyles(o);n.colToMove=undefined}return true};n.onRowMouseDown=function(r){var q=$(r.target).closest(".kgRow");if(!q[0]){return}var p=ko.dataFor(q[0]);if(p){q.attr("draggable","true");i.kg.eventStorage.rowToMove={targetRow:q,scope:p}}};n.onRowDrop=function(t){var s=$(t.target).closest(".kgRow");var p=ko.dataFor(s[0]);if(p){var v=i.kg.eventStorage.rowToMove;if(v.scope==p){return}var u=o.sortedData();var r=u.indexOf(v.scope.entity);var q=u.indexOf(p.entity);o.sortedData.splice(r,1);o.sortedData.splice(q,0,v.scope.entity);o.searchProvider.evalFilter();i.kg.eventStorage.rowToMove=undefined}};n.assignGridEventHandlers=function(){o.$viewport.scroll(function(q){var r=q.target.scrollLeft,p=q.target.scrollTop;o.adjustScrollLeft(r);o.adjustScrollTop(p)});o.$viewport.off("keydown");o.$viewport.on("keydown",function(p){return i.kg.moveSelectionHandler(o,p)});if(o.config.tabIndex===-1){o.$viewport.attr("tabIndex",i.kg.numberOfGrids);i.kg.numberOfGrids++}else{o.$viewport.attr("tabIndex",o.config.tabIndex)}$(i).resize(function(){i.kg.domUtilityService.UpdateGridLayout(o);if(o.config.maintainColumnRatios){o.configureColumnWidths()}})};n.assignGridEventHandlers();n.assignEvents()};i.kg.RowFactory=function(o){var n=this;n.rowCache=[];n.aggCache={};n.parentCache=[];n.dataChanged=true;n.parsedData=[];n.rowConfig={};n.selectionService=o.selectionService;n.rowHeight=30;n.numberOfAggregates=0;n.groupedData=undefined;n.rowHeight=o.config.rowHeight;n.rowConfig={canSelectRows:o.config.canSelectRows,rowClasses:o.config.rowClasses,selectedItems:o.config.selectedItems,selectWithCheckboxOnly:o.config.selectWithCheckboxOnly,beforeSelectionChangeCallback:o.config.beforeSelectionChange,afterSelectionChangeCallback:o.config.afterSelectionChange};n.renderedRange=new i.kg.Range(0,o.minRowsToRender()+m);n.buildEntityRow=function(p,r){var q=n.rowCache[r];if(!q){q=new i.kg.Row(p,n.rowConfig,n.selectionService);q.rowIndex(r+1);q.offsetTop((n.rowHeight*r).toString()+"px");q.selected(p[b]);n.rowCache[r]=q}return q};n.buildAggregateRow=function(r,q){var p=n.aggCache[r.aggIndex];if(!p){p=new i.kg.Aggregate(r,n);n.aggCache[r.aggIndex]=p}p.index=q+1;p.offsetTop((n.rowHeight*q).toString()+"px");return p};n.UpdateViewableRange=function(p){n.renderedRange=p;n.renderedChange()};n.filteredDataChanged=function(){if(o.lateBoundColumns&&o.filteredData().length>1){o.config.columnDefs=undefined;o.buildColumns();o.lateBoundColumns=false}n.dataChanged=true;n.rowCache=[];if(o.config.groups.length>0){n.getGrouping(o.config.groups)}n.UpdateViewableRange(n.renderedRange)};n.renderedChange=function(){if(!n.groupedData||o.config.groups.length<1){n.renderedChangeNoGroups();o.refreshDomSizes();return}n.parentCache=[];var q=[];var p=n.parsedData.filter(function(r){return r[g]===false}).slice(n.renderedRange.topRow,n.renderedRange.bottomRow);$.each(p,function(s,r){var t;if(r.isAggRow){t=n.buildAggregateRow(r,n.renderedRange.topRow+s)}else{t=n.buildEntityRow(r,n.renderedRange.topRow+s)}q.push(t)});o.setRenderedRows(q);o.refreshDomSizes()};n.renderedChangeNoGroups=function(){var q=[];var p=o.filteredData.slice(n.renderedRange.topRow,n.renderedRange.bottomRow);$.each(p,function(r,s){var t=n.buildEntityRow(s,n.renderedRange.topRow+r);q.push(t)});o.setRenderedRows(q)};n.parseGroupData=function(q){if(q.values){$.each(q.values,function(s,t){n.parentCache[n.parentCache.length-1].children.push(t);n.parsedData.push(t)})}else{for(var r in q){if(r==j||r==d||r==c){continue}else{if(q.hasOwnProperty(r)){var p=n.buildAggregateRow({gField:q[j],gLabel:r,gDepth:q[d],isAggRow:true,_kg_hidden_:false,children:[],aggChildren:[],aggIndex:n.numberOfAggregates,aggLabelFilter:q[c].aggLabelFilter},0);n.numberOfAggregates++;p.parent=n.parentCache[p.depth-1];if(p.parent){p.parent.collapsed(false);p.parent.aggChildren.push(p)}n.parsedData.push(p.entity);n.parentCache[p.depth]=p;n.parseGroupData(q[r])}}}}};n.getGrouping=function(p){n.aggCache=[];n.rowCache=[];n.numberOfAggregates=0;n.groupedData={};var q=o.filteredData();var s=p.length;var r=o.columns();$.each(q,function(t,u){u[g]=true;var v=n.groupedData;$.each(p,function(z,x){if(!r[z].isAggCol&&z<=s){o.columns.splice(u.gDepth,0,new i.kg.Column({colDef:{field:"",width:25,sortable:false,resizable:false,headerCellTemplate:'<div class="kgAggHeader"></div>',isGroupable:false},isAggCol:true,index:u.gDepth,headerRowHeight:o.config.headerRowHeight}));i.kg.domUtilityService.BuildStyles(o)}var w=r.filter(function(A){return A.field==x})[0];var y=i.kg.utils.evalProperty(u,x);if(w.cellFilter){y=w.cellFilter(y)}y=y?y.toString():"null";if(!v[y]){v[y]={}}if(!v[j]){v[j]=x}if(!v[d]){v[d]=z}if(!v[c]){v[c]=w}v=v[y]});if(!v.values){v.values=[]}v.values.push(u)});o.fixColumnIndexes();n.parsedData.length=0;n.parseGroupData(n.groupedData)};if(o.config.groups.length>0&&o.filteredData().length>0){n.getGrouping(o.config.groups)}};i.kg.Grid=function(o){var p={rowHeight:30,columnWidth:100,headerRowHeight:30,footerRowHeight:55,footerVisible:true,displayFooter:undefined,canSelectRows:true,selectAllState:ko.observable(false),data:ko.observableArray([]),columnDefs:undefined,selectedItems:ko.observableArray([]),displaySelectionCheckbox:true,selectWithCheckboxOnly:false,useExternalSorting:false,sortInfo:ko.observable(undefined),multiSelect:true,tabIndex:-1,enableColumnResize:true,enableSorting:true,maintainColumnRatios:undefined,beforeSelectionChange:function(){return true},afterSelectionChange:function(){},columnsChanged:function(){},rowTemplate:undefined,headerRowTemplate:undefined,jqueryUITheme:false,jqueryUIDraggable:false,plugins:[],keepLastSelected:true,groups:[],showGroupPanel:false,enableRowReordering:false,showColumnMenu:true,showFilter:true,searchColumn:undefined,disableTextSelection:true,filterOptions:{filterText:ko.observable(""),useExternalFilter:false},enablePaging:false,pagingOptions:{pageSizes:ko.observableArray([250,500,1000]),pageSize:ko.observable(250),totalServerItems:ko.observable(0),currentPage:ko.observable(1)}},n=this;n.maxCanvasHt=ko.observable(0);n.config=$.extend(p,o);n.config.columnDefs=ko.utils.unwrapObservable(o.columnDefs);n.gridId="ng"+i.kg.utils.newId();n.$root=null;n.$groupPanel=null;n.$topPanel=null;n.$headerContainer=null;n.$headerScroller=null;n.$headers=null;n.$viewport=null;n.$canvas=null;n.rootDim=n.config.gridDim;n.sortInfo=ko.isObservable(n.config.sortInfo)?n.config.sortInfo:ko.observable(n.config.sortInfo);n.sortedData=n.config.data;n.lateBindColumns=false;n.filteredData=ko.observableArray([]);n.lastSortedColumn=undefined;n.showFilter=n.config.showFilter;n.filterText=n.config.filterOptions.filterText;n.disableTextSelection=ko.observable(n.config.disableTextSelection);n.calcMaxCanvasHeight=function(){return(n.configGroups().length>0)?(n.rowFactory.parsedData.filter(function(q){return q[g]===false}).length*n.config.rowHeight):(n.filteredData().length*n.config.rowHeight)};n.elementDims={scrollW:0,scrollH:0,rowIndexCellW:25,rowSelectedCellW:25,rootMaxW:0,rootMaxH:0};n.setRenderedRows=function(q){n.renderedRows(q);n.refreshDomSizes()};n.minRowsToRender=function(){var q=n.viewportDimHeight()||1;return Math.floor(q/n.config.rowHeight)};n.refreshDomSizes=function(){n.rootDim.outerWidth(n.elementDims.rootMaxW);n.rootDim.outerHeight(n.elementDims.rootMaxH);n.maxCanvasHt(n.calcMaxCanvasHeight())};n.buildColumnDefsFromData=function(){var r=n.sortedData();if(!n.config.columnDefs){n.config.columnDefs=[]}if(!r||!r[0]){n.lateBoundColumns=true;return}var q;q=r[0];i.kg.utils.forIn(q,function(t,s){if(s!=b){n.config.columnDefs.push({field:s})}})};n.buildColumns=function(){var r=n.config.columnDefs,q=[];if(!r){n.buildColumnDefsFromData();r=n.config.columnDefs}if(n.config.displaySelectionCheckbox&&n.config.canSelectRows){r.splice(0,0,{field:"\u2714",width:n.elementDims.rowSelectedCellW,sortable:false,resizable:false,headerCellTemplate:'<input class="kgSelectionHeader" type="checkbox" data-bind="visible: $grid.multiSelect, checked: $grid.allSelected"/>',cellTemplate:'<div class="kgSelectionCell"><input class="kgSelectionCheckbox" type="checkbox" data-bind="checked: $parent.selected" /></div>'})}if(r.length>0){$.each(r,function(s,v){var t=new i.kg.Column({colDef:v,index:s,headerRowHeight:n.config.headerRowHeight,sortCallback:n.sortData,resizeOnDataCallback:n.resizeOnData,enableResize:n.config.enableColumnResize,enableSort:n.config.enableSorting,isGroupable:n.config.isGroupable},n);q.push(t);var u=n.config.groups.indexOf(v.field);if(u!=-1){n.configGroups.splice(u,0,t)}});n.columns(q)}};n.configureColumnWidths=function(){var x=n.config.columnDefs;var r=x.length,v=[],y=[],w=0,u=0;var s=n.columns();$.each(x,function(C,A){var D=false,B=undefined;if(i.kg.utils.isNullOrUndefined(A.width)){A.width="*"}else{D=isNaN(A.width)?i.kg.utils.endsWith(A.width,"%"):false;B=D?A.width:parseInt(A.width,10)}if(isNaN(B)){B=A.width;if(B=="auto"){s[C].width=s[C].minWidth;var z=s[C];$(document).ready(function(){n.resizeOnData(z,true)});return}else{if(B.indexOf("*")!=-1){w+=B.length;A.index=C;v.push(A);return}else{if(D){A.index=C;y.push(A);return}else{throw'unable to parse column width, use percentage ("10%","20%", etc...) or "*" to use remaining width of grid'}}}}else{u+=s[C].width=parseInt(A.width,10)}});if(v.length>0){n.config.maintainColumnRatios===false?$.noop():n.config.maintainColumnRatios=true;var q=n.rootDim.outerWidth()-u;var t=Math.floor(q/w);$.each(v,function(B,z){var A=z.width.length;s[z.index].width=t*A;if(z.index+1==r){var C=2;if(n.maxCanvasHt()>n.viewportDimHeight()){C+=i.kg.domUtilityService.ScrollW}s[z.index].width-=C}u+=s[z.index].width})}if(y.length>0){$.each(y,function(B,z){var A=z.width;s[z.index].width=Math.floor(n.rootDim.outerWidth()*(parseInt(A.slice(0,-1),10)/100))})}n.columns(s);i.kg.domUtilityService.BuildStyles(n)};n.init=function(){n.selectionService=new i.kg.SelectionService(n);n.rowFactory=new i.kg.RowFactory(n);n.selectionService.Initialize(n.rowFactory);n.searchProvider=new i.kg.SearchProvider(n);n.styleProvider=new i.kg.StyleProvider(n);n.buildColumns();i.kg.sortService.columns=n.columns;n.configGroups.subscribe(function(q){if(!q){return}var r=[];$.each(q,function(s,t){if(t){r.push(t.field||t)}});n.config.groups=r;n.rowFactory.filteredDataChanged()});n.filteredData.subscribe(function(){if(n.$$selectionPhase){return}n.maxCanvasHt(n.calcMaxCanvasHeight());if(!n.isSorting){n.configureColumnWidths()}});n.maxCanvasHt(n.calcMaxCanvasHeight());n.searchProvider.evalFilter();n.refreshDomSizes()};n.prevScrollTop=0;n.prevScrollIndex=0;n.adjustScrollTop=function(r,q){if(n.prevScrollTop===r&&!q){return}var s=Math.floor(r/n.config.rowHeight);if(n.prevScrollTop<r&&s<n.prevScrollIndex+a){return}if(n.prevScrollTop>r&&s>n.prevScrollIndex-a){return}n.prevScrollTop=r;n.rowFactory.UpdateViewableRange(new i.kg.Range(Math.max(0,s-m),s+n.minRowsToRender()+m));n.prevScrollIndex=s};n.adjustScrollLeft=function(q){if(n.$headerContainer){n.$headerContainer.scrollLeft(q)}};n.resizeOnData=function(r){var s=r.minWidth;var q=i.kg.utils.getElementsByClassName("col"+r.index);$.each(q,function(u,x){var v;if(u===0){var w=$(x).find(".kgHeaderText");v=i.kg.utils.visualLength(w)+10}else{var t=$(x).find(".kgCellText");v=i.kg.utils.visualLength(t)+10}if(v>s){s=v}});r.width=s=Math.min(r.maxWidth,s+7);i.kg.domUtilityService.BuildStyles(n)};n.sortData=function(q,r){n.isSorting=true;n.sortInfo({column:q,direction:r});n.clearSortingData(q);if(!n.config.useExternalSorting){i.kg.sortService.Sort(n.sortInfo.peek(),n.sortedData)}else{n.config.sortInfo(n.sortInfo.peek())}n.lastSortedColumn=q;n.isSorting=false};n.clearSortingData=function(q){if(!q){$.each(n.columns(),function(r,s){s.sortDirection("")})}else{if(n.lastSortedColumn&&q!=n.lastSortedColumn){n.lastSortedColumn.sortDirection("")}}};n.fixColumnIndexes=function(){n.$$indexPhase=true;var q=n.columns.peek();$.each(q,function(s,r){r.index=s});n.$$indexPhase=false};n.elementsNeedMeasuring=true;n.columns=ko.observableArray([]);n.columns.subscribe(function(q){n.config.columnsChanged(q)});n.renderedRows=ko.observableArray([]);n.headerRow=null;n.rowHeight=n.config.rowHeight;n.jqueryUITheme=ko.observable(n.config.jqueryUITheme);n.footer=null;n.selectedItems=n.config.selectedItems;n.multiSelect=n.config.multiSelect;n.footerVisible=i.kg.utils.isNullOrUndefined(n.config.displayFooter)?n.config.footerVisible:n.config.displayFooter;n.config.footerRowHeight=n.footerVisible?n.config.footerRowHeight:0;n.showColumnMenu=n.config.showColumnMenu;n.showMenu=ko.observable(false);n.configGroups=ko.observableArray([]);n.enablePaging=n.config.enablePaging;n.pagingOptions=n.config.pagingOptions;n.rowTemplate=n.config.rowTemplate||i.kg.defaultRowTemplate();n.headerRowTemplate=n.config.headerRowTemplate||i.kg.defaultHeaderRowTemplate();if(n.config.rowTemplate&&!h.test(n.config.rowTemplate)){n.rowTemplate=i.kg.utils.getTemplatePromise(n.config.rowTemplate)}if(n.config.headerRowTemplate&&!h.test(n.config.headerRowTemplate)){n.headerRowTemplate=i.kg.utils.getTemplatePromise(n.config.headerRowTemplate)}n.visibleColumns=ko.computed(function(){var q=n.columns();return q.filter(function(s){var r=s.visible();return r})});n.groupableByCol=ko.computed(function(){return n.columns().filter(function(q){return q.isGroupable})});n.nonAggColumns=ko.computed(function(){return n.columns().filter(function(q){return !q.isAggCol})});n.aggColumns=ko.computed(function(){return n.columns().filter(function(q){return q.isAggCol})});n.toggleShowMenu=function(){n.showMenu(!n.showMenu())};n.allSelected=n.config.selectAllState;n.allSelected.subscribe(function(q){if(n.config.beforeSelectionChange(n.sortedData.peek(),this)){n.selectionService.toggleSelectAll(q);n.config.afterSelectionChange(n.selectedItems.peek(),this)}});n.totalFilteredItemsLength=ko.computed(function(){return n.filteredData().length});n.showGroupPanel=ko.computed(function(){return n.config.showGroupPanel});n.topPanelHeight=ko.observable(n.config.showGroupPanel===true?(n.config.headerRowHeight*2):n.config.headerRowHeight);n.viewportDimHeight=ko.computed(function(){return Math.max(0,n.rootDim.outerHeight()-n.topPanelHeight()-n.config.footerRowHeight-2)});n.groupBy=function(q){if(n.sortedData().length<1){return}var r=n.configGroups().indexOf(q);if(r==-1){q.isGroupedBy(true);n.configGroups.push(q);q.groupIndex(n.configGroups().length)}else{n.removeGroup(r)}i.kg.domUtilityService.BuildStyles(n)};n.removeGroup=function(r){var q=n.columns().filter(function(s){return s.groupIndex()==(r+1)})[0];q.isGroupedBy(false);q.groupIndex(0);n.columns.splice(r,1);n.configGroups.splice(r,1);n.fixGroupIndexes();if(n.configGroups().length===0){n.fixColumnIndexes()}i.kg.domUtilityService.BuildStyles(n)};n.fixGroupIndexes=function(){$.each(n.configGroups(),function(q,r){r.groupIndex(q+1)})};n.totalRowWidth=function(){var q=0,r=n.visibleColumns();$.each(r,function(t,s){q+=s.width});return q};n.headerScrollerDim=function(){var r=n.viewportDimHeight(),s=n.maxCanvasHt(),t=(s>r),q=new i.kg.Dimension();q.autoFitHeight=true;q.outerWidth=n.totalRowWidth();if(t){q.outerWidth+=n.elementDims.scrollW}else{if((s-r)<=n.elementDims.scrollH){q.outerWidth+=n.elementDims.scrollW}}return q};n.jqueryUITheme=n.config.jqueryUITheme;n.maxRows=ko.observable(Math.max(n.config.pagingOptions.totalServerItems()||n.sortedData().length,1));n.maxRowsDisplay=ko.computed(function(){return n.maxRows()});n.multiSelect=ko.observable((n.config.canSelectRows&&n.config.multiSelect));n.selectedItemCount=ko.computed(function(){return n.selectedItems().length});n.maxPages=ko.computed(function(){n.maxRows(Math.max(n.config.pagingOptions.totalServerItems()||n.sortedData().length,1));return Math.ceil(n.maxRows()/n.pagingOptions.pageSize())});n.pageForward=function(){var q=n.config.pagingOptions.currentPage();n.config.pagingOptions.currentPage(Math.min(q+1,n.maxPages()))};n.pageBackward=function(){var q=n.config.pagingOptions.currentPage();n.config.pagingOptions.currentPage(Math.max(q-1,1))};n.pageToFirst=function(){n.config.pagingOptions.currentPage(1)};n.pageToLast=function(){var q=n.maxPages();n.config.pagingOptions.currentPage(q)};n.cantPageForward=ko.computed(function(){var r=n.config.pagingOptions.currentPage();var q=n.maxPages();return !(r<q)});n.cantPageBackward=ko.computed(function(){var q=n.config.pagingOptions.currentPage();return !(q>1)});n.init()};kg.Range=function(o,n){this.topRow=o;this.bottomRow=n};i.kg.Row=function(o,p,q){var n=this;n.canSelectRows=p.canSelectRows;n.rowClasses=p.rowClasses;n.selectedItems=p.selectedItems;n.entity=o;n.selectionService=q;n.selected=ko.observable(false);n.continueSelection=function(r){n.selectionService.ChangeSelection(n,r)};n.toggleSelected=function(t,s){if(!n.canSelectRows){return true}var r=s.target||s;if(r.type=="checkbox"){n.selected(!n.selected())}if(p.selectWithCheckboxOnly&&r.type!="checkbox"){return true}else{if(n.beforeSelectionChange(n,s)){n.continueSelection(s);return n.afterSelectionChange(n,s)}}return false};if(n.entity[b]===undefined){n.entity[b]=false}else{n.selectionService.setSelection(n,n.entity[b])}n.rowIndex=ko.observable(0);n.offsetTop=ko.observable("0px");n.rowDisplayIndex=0;n.isEven=ko.computed(function(){if(n.rowIndex()%2===0){return true}return false});n.isOdd=ko.computed(function(){if(n.rowIndex()%2!==0){return true}return false});n.beforeSelectionChange=p.beforeSelectionChangeCallback;n.afterSelectionChange=p.afterSelectionChangeCallback;n.propertyCache={};n.getProperty=function(r){return n.propertyCache[r]||(n.propertyCache[r]=i.kg.utils.evalProperty(n.entity,r))}};i.kg.SearchProvider=function(q){var p=this,n=[],t;p.extFilter=q.config.filterOptions.useExternalFilter;p.showFilter=q.config.showFilter;p.filterText=q.config.filterOptions.filterText;p.throttle=q.config.filterOptions.filterThrottle;p.fieldMap={};p.evalFilter=function(){if(n.length===0){q.filteredData(q.sortedData.peek().filter(function(u){return !u._destroy}))}else{q.filteredData(q.sortedData.peek().filter(function(w){if(w._destroy){return false}for(var v=0,u=n.length;v<u;v++){var A=n[v];if(A.column===""||A.column===undefined){A.column=q.config.searchColumn}if(!A.column){for(var z in w){if(w.hasOwnProperty(z)){var y=ko.utils.unwrapObservable(w[z]);if(y&&A.regex.test(y.toString())){return true}}}return false}var x=ko.utils.unwrapObservable(w[A.column])||ko.utils.unwrapObservable(w[p.fieldMap[A.columnDisplay]]);if(!x||!A.regex.test(x.toString())){return false}}return true}))}q.rowFactory.filteredDataChanged()};var o=function(w,u){try{return new RegExp(w,u)}catch(v){return new RegExp(w.replace(/(\^|\$|\(|\)|\<|\>|\[|\]|\{|\}|\\|\||\.|\*|\+|\?)/g,"\\$1"))}};var s=function(u){n=[];var w;if(!(w=$.trim(u))){return}var v=w.split(";");$.each(v,function(z,A){var y=A.split(":");if(y.length>1){var x=$.trim(y[0]);var C=$.trim(y[1]);if(x&&C){n.push({column:x,columnDisplay:x.replace(/\s+/g,"").toLowerCase(),regex:o(C,"i")})}}else{var B=$.trim(y[0]);if(B){n.push({column:"",regex:o(B,"i")})}}})};var r=ko.computed(function(){var u=p.filterText();if(!p.extFilter&&u!=t){t=u;s(u);p.evalFilter()}});if(typeof p.throttle==="number"){r.extend({throttle:p.throttle})}if(!p.extFilter){q.columns.subscribe(function(u){$.each(u,function(w,v){p.fieldMap[v.displayName().toLowerCase().replace(/\s+/g,"")]=v.field})})}};i.kg.SelectionService=function(o){var n=this;n.multi=o.config.multiSelect;n.selectedItems=o.config.selectedItems;n.selectedIndex=o.config.selectedIndex;n.lastClickedRow=undefined;n.ignoreSelectedItemChanges=false;n.rowFactory={};n.Initialize=function(p){n.rowFactory=p};n.ChangeSelection=function(s,q){o.$$selectionPhase=true;if(q&&q.shiftKey&&n.multi){if(n.lastClickedRow){var r=o.filteredData.indexOf(s.entity);var p=o.filteredData.indexOf(n.lastClickedRow.entity);if(o.aggColumns().length>0){r=o.rowFactory.rowCache.indexOf(s);p=o.rowFactory.rowCache.indexOf(n.lastClickedRow)}if(r==p){return false}p++;if(r<p){r=r^p;p=r^p;r=r^p}var t=[];for(;p<=r;p++){t.push(n.rowFactory.rowCache[p])}if(t[t.length-1].beforeSelectionChange(t,q)){$.each(t,function(v,u){u.selected(true);u.entity[b]=true;if(n.selectedItems.indexOf(u.entity)===-1){n.selectedItems.push(u.entity)}});t[t.length-1].afterSelectionChange(t,q)}n.lastClickedRow=t[t.length-1];o.$$selectionPhase=false;return true}}else{if(!n.multi){if(n.lastClickedRow&&n.lastClickedRow!=s){n.setSelection(n.lastClickedRow,false)}n.setSelection(s,o.config.keepLastSelected?true:!s.selected())}else{n.setSelection(s,!s.selected())}}n.lastClickedRow=s;o.$$selectionPhase=false;return true};n.setSelection=function(r,p){r.selected(p);r.entity[b]=p;if(!p){var q=n.selectedItems.indexOf(r.entity);n.selectedItems.splice(q,1)}else{if(n.selectedItems.indexOf(r.entity)===-1){n.selectedItems.push(r.entity)}}};n.toggleSelectAll=function(p){var q=n.selectedItems().length;if(q>0){n.selectedItems.splice(0,q)}$.each(o.filteredData(),function(r,s){s[b]=p;if(p){n.selectedItems.push(s)}});$.each(n.rowFactory.rowCache,function(r,s){if(s&&s.selected){s.selected(p)}})}};i.kg.StyleProvider=function(n){n.canvasStyle=ko.computed(function(){return{height:n.maxCanvasHt().toString()+"px"}});n.headerScrollerStyle=ko.computed(function(){return{height:n.config.headerRowHeight+"px"}});n.topPanelStyle=ko.computed(function(){return{width:n.rootDim.outerWidth()+"px",height:n.topPanelHeight()+"px"}});n.headerStyle=ko.computed(function(){return{width:Math.max(0,n.rootDim.outerWidth()-i.kg.domUtilityService.ScrollW)+"px",height:n.config.headerRowHeight+"px"}});n.viewportStyle=ko.computed(function(){return{width:n.rootDim.outerWidth()+"px",height:n.viewportDimHeight()+"px"}});n.footerStyle=ko.computed(function(){return{width:n.rootDim.outerWidth()+"px",height:n.config.footerRowHeight+"px"}})};i.kg.sortService={colSortFnCache:{},dateRE:/^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)$/,guessSortFn:function(p){var q,s,o,r,n;if(p===undefined||p===null||p===""){return null}s=typeof(p);switch(s){case"number":q=i.kg.sortService.sortNumber;break;case"boolean":q=i.kg.sortService.sortBool;break;default:q=undefined;break}if(q){return q}if(Object.prototype.toString.call(p)==="[object Date]"){return i.kg.sortService.sortDate}if(s!=="string"){return i.kg.sortService.basicSort}if(p.match(/^-?[£$¤]?[\d,.]+%?$/)){return i.kg.sortService.sortNumberStr}o=p.match(i.kg.sortService.dateRE);if(o){r=parseInt(o[1],10);n=parseInt(o[2],10);if(r>12){return i.kg.sortService.sortDDMMStr}else{if(n>12){return i.kg.sortService.sortMMDDStr}else{return i.kg.sortService.sortMMDDStr}}}return i.kg.sortService.sortAlpha},basicSort:function(o,n){if(o==n){return 0}if(o<n){return -1}return 1},sortNumber:function(o,n){return o-n},sortNumberStr:function(p,n){var s,r,q=false,o=false;s=parseFloat(p.replace(/[^0-9.-]/g,""));if(isNaN(s)){q=true}r=parseFloat(n.replace(/[^0-9.-]/g,""));if(isNaN(r)){o=true}if(q&&o){return 0}if(q){return 1}if(o){return -1}return s-r},sortAlpha:function(p,n){var q=p.toLowerCase(),o=n.toLowerCase();return q==o?0:(q<o?-1:1)},sortBool:function(o,n){if(o&&n){return 0}if(!o&&!n){return 0}else{return o?1:-1}},sortDate:function(o,n){var q=o.getTime(),p=n.getTime();return q==p?0:(q<p?-1:1)},sortDDMMStr:function(p,o){var r,q,s,n,t,u;s=p.match(i.kg.sortService.dateRE);u=s[3];n=s[2];t=s[1];if(n.length==1){n="0"+n}if(t.length==1){t="0"+t}r=u+n+t;s=o.match(i.kg.sortService.dateRE);u=s[3];n=s[2];t=s[1];if(n.length==1){n="0"+n}if(t.length==1){t="0"+t}q=u+n+t;if(r==q){return 0}if(r<q){return -1}return 1},sortMMDDStr:function(p,o){var r,q,s,n,t,u;s=p.match(i.kg.sortService.dateRE);u=s[3];t=s[2];n=s[1];if(n.length==1){n="0"+n}if(t.length==1){t="0"+t}r=u+n+t;s=o.match(dateRE);u=s[3];t=s[2];n=s[1];if(n.length==1){n="0"+n}if(t.length==1){t="0"+t}q=u+n+t;if(r==q){return 0}if(r<q){return -1}return 1},sortData:function(s,o){var n=s();if(!n||!o){return}var p=o.column,t=o.direction,r,q;if(i.kg.sortService.colSortFnCache[p.field]){r=i.kg.sortService.colSortFnCache[p.field]}else{if(p.sortingAlgorithm!=undefined){r=p.sortingAlgorithm;i.kg.sortService.colSortFnCache[p.field]=p.sortingAlgorithm}else{q=n[0];if(!q){return}r=kg.sortService.guessSortFn(q[p.field]);if(r){i.kg.sortService.colSortFnCache[p.field]=r}else{r=i.kg.sortService.sortAlpha}}}n.sort(function(w,v){var u=i.kg.utils.evalProperty(w,p.field);var x=i.kg.utils.evalProperty(v,p.field);if(!x&&!u){return 0}else{if(!u){return 1}else{if(!x){return -1}}}if(t===e){return r(u,x)}else{return 0-r(u,x)}});s(n);return},Sort:function(n,o){if(i.kg.sortService.isSorting){return}i.kg.sortService.isSorting=true;i.kg.sortService.sortData(o,n);i.kg.sortService.isSorting=false}};var l=function(){var n=$("<div></div>");n.appendTo("body");n.height(100).width(100).css("position","absolute").css("overflow","scroll");n.append('<div style="height: 400px; width: 400px;"></div>');i.kg.domUtilityService.ScrollH=(n.height()-n[0].clientHeight);i.kg.domUtilityService.ScrollW=(n.width()-n[0].clientWidth);n.empty();n.attr("style","");n.append('<span style="font-family: Verdana, Helvetica, Sans-Serif; font-size: 14px;"><strong>M</strong></span>');i.kg.domUtilityService.LetterW=n.children().first().width();n.remove()};i.kg.domUtilityService={AssignGridContainers:function(o,n){n.$root=$(o);n.$topPanel=n.$root.find(".kgTopPanel");n.$groupPanel=n.$root.find(".kgGroupPanel");n.$headerContainer=n.$topPanel.find(".kgHeaderContainer");n.$headerScroller=n.$topPanel.find(".kgHeaderScroller");n.$headers=n.$headerScroller.children();n.$viewport=n.$root.find(".kgViewport");n.$canvas=n.$viewport.find(".kgCanvas");n.$footerPanel=n.$root.find(".ngFooterPanel");i.kg.domUtilityService.UpdateGridLayout(n)},UpdateGridLayout:function(n){var o=n.$viewport.scrollTop();n.elementDims.rootMaxW=n.$root.width();n.elementDims.rootMaxH=n.$root.height();n.refreshDomSizes();n.adjustScrollTop(o,true)},BuildStyles:function(q){var s=q.config.rowHeight,o=q.$styleSheet,n=q.gridId,p,u=q.visibleColumns(),r=0;if(!o){o=$("#"+n);if(!o[0]){o=$("<style id='"+n+"' type='text/css' rel='stylesheet' />");o.appendTo("body")}}o.empty();var t=q.totalRowWidth();p="."+n+" .kgCanvas { width: "+t+"px; }."+n+" .kgRow { width: "+t+"px; }."+n+" .kgCell { height: "+s+"px; }."+n+" .kgCanvas { width: "+t+"px; }."+n+" .kgHeaderCell { top: 0; bottom: 0; }."+n+" .kgHeaderScroller { width: "+(t+i.kg.domUtilityService.scrollH+2)+"px}";$.each(u,function(w,v){p+="."+n+" .col"+w+" { width: "+v.width+"px; left: "+r+"px; right: "+(t-r-v.width)+"px; height: "+s+"px }."+n+" .colt"+w+" { width: "+v.width+"px; }";r+=v.width});if(i.kg.utils.isIe){o[0].styleSheet.cssText=p}else{o.append(document.createTextNode(p))}q.$styleSheet=o},ScrollH:17,ScrollW:17,LetterW:10};l()}(window));